<div class="combo-detail-page">
  <div class="container">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Carregando combo...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>

    <!-- Combo Detail -->
    <div *ngIf="!loading && !error && combo" class="combo-detail">
      <!-- Breadcrumb -->
      <nav class="breadcrumb">
        <a routerLink="/">Home</a>
        <span>></span>
        <a routerLink="/combos">Combos</a>
        <span>></span>
        <span>{{ combo.name }}</span>
      </nav>

      <!-- Layout Desktop: Grid 2 Colunas (Imagem + Informações) -->
      <div class="combo-main-layout">
        <!-- Coluna Esquerda: Imagem -->
        <div class="combo-image-column">
          <div class="combo-hero-section">
            <div *ngIf="getDiscountPercentage(combo) > 0" class="discount-badge">
              -{{ getDiscountPercentage(combo) }}%
            </div>
            <div class="combo-image-wrapper">
              <img [src]="getComboImage(combo)" [alt]="combo.name" class="combo-hero-image">
            </div>
          </div>
        </div>

        <!-- Coluna Direita: Informações -->
        <div class="combo-info-column">
          <div class="combo-header-section">
            <h1 class="combo-title">{{ combo.name }}</h1>
            
            <div class="combo-price-section">
              <div *ngIf="combo.original_price && combo.original_price > combo.price" class="original-price-large">
                {{ formatPrice(combo.original_price) }}
              </div>
              <div class="current-price-large">
                {{ formatPrice(combo.price) }}
              </div>
              <div *ngIf="combo.original_price && combo.original_price > combo.price" class="savings-badge">
                <mat-icon>savings</mat-icon>
                <span>Economize {{ formatPrice(combo.original_price - combo.price) }}</span>
              </div>
            </div>

            <p *ngIf="combo.description" class="combo-description-large">
              {{ combo.description }}
            </p>
          </div>
        </div>
      </div>

      <!-- Lista de Itens do Combo -->
      <div class="combo-products-section">
        <h2 class="section-title">
          <mat-icon>inventory_2</mat-icon>
          <span>Produtos Inclusos</span>
        </h2>
        <div class="products-grid">
          <div *ngFor="let product of combo.products" class="product-card-item">
            <div class="product-image-wrapper">
              <img [src]="getProductImage(product)" 
                   [alt]="getProductName(product)" 
                   class="product-thumbnail"
                   onerror="this.src='/assets/images/no-image.jpg'">
            </div>
            <div class="product-info-wrapper">
              <h3 class="product-name">{{ getProductName(product) }}</h3>
              <div class="product-quantity-badge">
                <mat-icon>shopping_cart</mat-icon>
                <span>{{ getProductQuantity(product) }} {{ getProductUnit(product) }}</span>
              </div>
            </div>
            <div class="product-price-wrapper">
              <span class="product-unit-price">{{ formatPrice(getProductPrice(product)) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Controles de Quantidade (Desktop) -->
      <div class="combo-actions-desktop">
        <div class="quantity-controls">
          <label for="quantity">Quantidade:</label>
          <div class="quantity-input">
            <button (click)="decrementQuantity()" type="button" class="quantity-btn" [disabled]="quantity <= 1">
              <mat-icon>remove</mat-icon>
            </button>
            <input 
              type="number" 
              id="quantity"
              [(ngModel)]="quantity" 
              min="1" 
              class="quantity-field"
              readonly>
            <button (click)="incrementQuantity()" type="button" class="quantity-btn">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>
        <button (click)="onAddToCart()" class="add-to-cart-btn-large">
          <mat-icon>add_shopping_cart</mat-icon>
          <span>Adicionar ao Carrinho</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Rodapé Fixo (Mobile) -->
  <div class="combo-actions-mobile" *ngIf="!loading && !error && combo">
    <div class="quantity-controls-mobile">
      <button (click)="decrementQuantity()" type="button" class="quantity-btn-mobile" [disabled]="quantity <= 1">
        <mat-icon>remove</mat-icon>
      </button>
      <span class="quantity-display">{{ quantity }}</span>
      <button (click)="incrementQuantity()" type="button" class="quantity-btn-mobile">
        <mat-icon>add</mat-icon>
      </button>
    </div>
    <button (click)="onAddToCart()" class="add-to-cart-btn-mobile">
      <mat-icon>add_shopping_cart</mat-icon>
      <span>Adicionar</span>
      <span class="price-mobile">{{ formatPrice(combo.price * quantity) }}</span>
    </button>
  </div>
</div>
