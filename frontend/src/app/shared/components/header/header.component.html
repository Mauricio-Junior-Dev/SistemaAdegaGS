<!-- Banner de Loja Fechada -->
<div *ngIf="!(isStoreOpen$ | async)" class="store-closed-banner">
  <div class="banner-content">
    <mat-icon class="banner-icon">info</mat-icon>
    <span>ðŸ”´ Estamos fechados no momento</span>
  </div>
</div>

<header class="header">
  <nav class="container header-content">
    <!-- Logo -->
    <a routerLink="/" class="logo">
      <img *ngIf="settings?.logo_url" 
           [src]="getLogoUrl(settings?.logo_url)" 
           alt="Logo" 
           class="logo-image">
      <span *ngIf="!settings?.logo_url" class="logo-text">{{settings?.site_name || 'ADEGA GS'}}</span>
    </a>

    <!-- NavegaÃ§Ã£o Desktop -->
    <nav class="desktop-nav">
      <a routerLink="/" 
         routerLinkActive="active"
         [routerLinkActiveOptions]="{exact: true}"
         class="nav-link">
        Home
      </a>
      <a routerLink="/produtos" 
         routerLinkActive="active"
         class="nav-link">
        CardÃ¡pio
      </a>
      <ng-container *ngIf="user$ | async; else navLogin">
        <a routerLink="/pedidos" 
           routerLinkActive="active"
           class="nav-link">
          Meus Pedidos
        </a>
        <a routerLink="/perfil" 
           routerLinkActive="active"
           class="nav-link">
          Perfil
        </a>
      </ng-container>
      <ng-template #navLogin>
        <a routerLink="/login" class="nav-link">
          Login
        </a>
      </ng-template>
    </nav>

    <!-- BotÃµes de AÃ§Ã£o -->
    <div class="action-buttons">
      <!-- Campo de Busca -->
      <div class="search-field">
        <mat-icon class="search-icon">search</mat-icon>
        <input type="text" 
               [(ngModel)]="searchTerm" 
               (keyup)="onSearch($event)"
               placeholder="Buscar" 
               class="search-input">
      </div>

      <!-- Ãcone do Carrinho com Badge -->
      <button mat-icon-button (click)="openCart()" class="cart-btn-icon" aria-label="Carrinho de compras">
        <mat-icon>shopping_cart</mat-icon>
        <ng-container *ngIf="cartItemCount$ | async as count">
          <span class="cart-badge" *ngIf="count > 0">
            {{ count > 99 ? '99+' : count }}
          </span>
        </ng-container>
      </button>

      <!-- BotÃ£o de Login/Perfil -->
      <ng-container *ngIf="user$ | async as user; else loginButton">
        <button mat-button [matMenuTriggerFor]="profileMenu" class="profile-button">
          <img *ngIf="user.avatar" 
               [src]="user.avatar" 
               [alt]="user.name"
               class="user-avatar">
          <mat-icon *ngIf="!user.avatar">person</mat-icon>
          <span>{{ user.name }}</span>
        </button>
        <mat-menu #profileMenu="matMenu">
          <button mat-menu-item routerLink="/perfil">
            <mat-icon>account_circle</mat-icon>
            <span>Meu Perfil</span>
          </button>
          <button mat-menu-item (click)="logout()">
            <mat-icon>exit_to_app</mat-icon>
            <span>Sair</span>
          </button>
        </mat-menu>
      </ng-container>
      
      <ng-template #loginButton>
        <button mat-button routerLink="/login" class="login-button">
          <mat-icon>login</mat-icon>
          <span>Login</span>
        </button>
      </ng-template>

    </div>
  </nav>
</header>

<!-- EspaÃ§ador removido - usando position: sticky agora -->