<div class="copao-modal">
  <div class="modal-header">
    <h2>ü•É Montar Cop√£o / Dose</h2>
    <button mat-icon-button (click)="cancel()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Indicador de Passos -->
  <div class="steps-indicator">
    <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
      <div class="step-number">1</div>
      <div class="step-label">Bebida</div>
    </div>
    <div class="step-line"></div>
    <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
      <div class="step-number">2</div>
      <div class="step-label">Acompanhamento</div>
    </div>
    <div class="step-line"></div>
    <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
      <div class="step-number">3</div>
      <div class="step-label">Gelo</div>
    </div>
  </div>

  <div class="modal-content">
    <!-- Passo 1: A Bebida (Obrigat√≥rio) -->
    <div *ngIf="currentStep === 1" class="step-content">
      <h3>Escolha a Bebida</h3>
      <p class="step-description">Selecione a dose que deseja adicionar ao cop√£o</p>

      <!-- Busca -->
      <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar bebida</mat-label>
      <input matInput [(ngModel)]="searchBeverage" placeholder="Digite o nome...">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

      <!-- Loading -->
      <div *ngIf="loadingBeverage" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Carregando bebidas...</p>
      </div>

      <!-- Lista de Bebidas -->
      <div *ngIf="!loadingBeverage" class="products-grid">
        <div *ngFor="let product of getFilteredBeverages()" 
             class="product-card"
             [class.selected]="selectedBeverage?.id === product.id"
             (click)="selectBeverage(product)">
          <div class="product-image">
            <img [src]="getProductImage(product)" [alt]="product.name" 
                 onerror="this.src='/assets/images/no-image.png'">
          </div>
          <div class="product-info">
            <h4>{{ product.name }}</h4>
            <div class="product-price">
              <span class="dose-price" *ngIf="product.dose_price">
                Dose: {{ formatPrice(product.dose_price) }}
              </span>
              <span class="bottle-price" *ngIf="!product.dose_price">
                {{ formatPrice(product.price) }}
              </span>
            </div>
            <div class="product-stock" [class.out-of-stock]="product.current_stock === 0">
              Estoque: {{ product.current_stock }}
            </div>
          </div>
          <div class="select-indicator" *ngIf="selectedBeverage?.id === product.id">
            <mat-icon>check_circle</mat-icon>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loadingBeverage && getFilteredBeverages().length === 0" class="empty-state">
        <mat-icon>search_off</mat-icon>
        <p>Nenhuma bebida encontrada</p>
      </div>
    </div>

    <!-- Passo 2: O Acompanhamento (Opcional) -->
    <div *ngIf="currentStep === 2" class="step-content">
      <h3>Escolha o Acompanhamento</h3>
      <p class="step-description">Selecione um acompanhamento ou pule esta etapa</p>

      <!-- Busca -->
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Buscar acompanhamento</mat-label>
        <input matInput [(ngModel)]="searchAccompaniment" placeholder="Digite o nome...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <!-- Bot√£o Pular -->
      <button mat-stroked-button 
              color="warn" 
              class="skip-button"
              (click)="skipAccompanimentStep()">
        <mat-icon>close</mat-icon>
        Sem Acompanhamento
      </button>

      <!-- Loading -->
      <div *ngIf="loadingAccompaniment" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Carregando acompanhamentos...</p>
      </div>

      <!-- Lista de Acompanhamentos -->
      <div *ngIf="!loadingAccompaniment" class="products-grid">
        <div *ngFor="let product of getFilteredAccompaniments()" 
             class="product-card"
             [class.selected]="selectedAccompaniment?.id === product.id"
             (click)="selectAccompaniment(product)">
          <div class="product-image">
            <img [src]="getProductImage(product)" [alt]="product.name"
                 onerror="this.src='/assets/images/no-image.png'">
          </div>
          <div class="product-info">
            <h4>{{ product.name }}</h4>
            <div class="product-price">
              {{ formatPrice(product.price) }}
            </div>
            <div class="product-stock" [class.out-of-stock]="product.current_stock === 0">
              Estoque: {{ product.current_stock }}
            </div>
          </div>
          <div class="select-indicator" *ngIf="selectedAccompaniment?.id === product.id">
            <mat-icon>check_circle</mat-icon>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loadingAccompaniment && getFilteredAccompaniments().length === 0" class="empty-state">
        <mat-icon>search_off</mat-icon>
        <p>Nenhum acompanhamento encontrado</p>
      </div>
    </div>

    <!-- Passo 3: O Gelo (Opcional) -->
    <div *ngIf="currentStep === 3" class="step-content">
      <h3>Escolha o Gelo</h3>
      <p class="step-description">Selecione um gelo de sabor ou pule esta etapa</p>

      <!-- Busca -->
      <mat-form-field appearance="outline" class="search-field">
      <mat-label>Buscar gelo</mat-label>
      <input matInput [(ngModel)]="searchIce" placeholder="Digite o nome...">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

      <!-- Bot√£o Pular -->
      <button mat-stroked-button 
              color="warn" 
              class="skip-button"
              (click)="skipIceStep()">
        <mat-icon>close</mat-icon>
        Sem Gelo
      </button>

      <!-- Loading -->
      <div *ngIf="loadingIce" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Carregando gelos...</p>
      </div>

      <!-- Lista de Gelos -->
      <div *ngIf="!loadingIce" class="products-grid">
        <div *ngFor="let product of getFilteredIce()" 
             class="product-card"
             [class.selected]="selectedIce?.id === product.id"
             (click)="selectIce(product)">
          <div class="product-image">
            <img [src]="getProductImage(product)" [alt]="product.name"
                 onerror="this.src='/assets/images/no-image.png'">
          </div>
          <div class="product-info">
            <h4>{{ product.name }}</h4>
            <div class="product-price">
              {{ formatPrice(product.price) }}
            </div>
            <div class="product-stock" [class.out-of-stock]="product.current_stock === 0">
              Estoque: {{ product.current_stock }}
            </div>
          </div>
          <div class="select-indicator" *ngIf="selectedIce?.id === product.id">
            <mat-icon>check_circle</mat-icon>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loadingIce && getFilteredIce().length === 0" class="empty-state">
        <mat-icon>search_off</mat-icon>
        <p>Nenhum gelo encontrado</p>
      </div>
    </div>
  </div>

  <!-- Footer com Bot√µes de Navega√ß√£o -->
  <div class="modal-footer">
    <button mat-stroked-button 
            (click)="previousStep()" 
            [disabled]="currentStep === 1">
      <mat-icon>arrow_back</mat-icon>
      Voltar
    </button>
    
    <button mat-raised-button 
            color="primary" 
            *ngIf="currentStep < totalSteps"
            (click)="nextStep()"
            [disabled]="!canProceed()">
      Pr√≥ximo
      <mat-icon>arrow_forward</mat-icon>
    </button>
    
    <button mat-raised-button 
            color="accent" 
            *ngIf="currentStep === totalSteps"
            (click)="finish()"
            [disabled]="!selectedBeverage">
      <mat-icon>check</mat-icon>
      Concluir e Adicionar ao Carrinho
    </button>
  </div>
</div>

