<div class="dashboard-container">
  <h1>Dashboard</h1>

  <!-- Loading e Error States -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Carregando informações...</p>
  </div>

  <div *ngIf="error" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>Erro ao carregar informações</p>
    <button mat-raised-button color="primary" (click)="isEmployee ? loadEmployeeData(true) : loadSummary(true)">Tentar Novamente</button>
  </div>

  <!-- Dashboard Content - Admin -->
  <div *ngIf="!loading && !error && summary && isAdmin" class="dashboard-content">
    <!-- Status do Caixa -->
    <mat-card class="status-card" [ngClass]="{'open': summary.cash.is_open}">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>point_of_sale</mat-icon>
          <h2>Status do Caixa</h2>
        </div>
        <div class="card-body">
          <p class="status">{{summary.cash.is_open ? 'ABERTO' : 'FECHADO'}}</p>
          <p class="amount" *ngIf="summary.cash.is_open">
            Saldo Atual: {{formatCurrency(summary.cash.current_amount)}}
          </p>
        </div>
        <div class="card-actions">
          <button mat-raised-button color="primary" [routerLink]="['/funcionario/caixa']">
            {{summary.cash.is_open ? 'Gerenciar Caixa' : 'Abrir Caixa'}}
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Vendas do Dia -->
    <mat-card class="summary-card">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>payments</mat-icon>
          <h2>Vendas do Dia</h2>
        </div>
        <div class="card-body">
          <div class="stat">
            <span class="label">Total</span>
            <span class="value">{{formatCurrency(summary.sales.total_amount)}}</span>
          </div>
          <div class="stat">
            <span class="label">Pedidos</span>
            <span class="value">{{summary.sales.total_orders}}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Status dos Pedidos -->
    <mat-card class="summary-card">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>receipt_long</mat-icon>
          <h2>Status dos Pedidos</h2>
        </div>
        <div class="card-body">
          <div class="stat">
            <span class="label">Pendentes</span>
            <span class="value highlight">{{summary.orders.pending}}</span>
          </div>
          <div class="stat">
            <span class="label">Em Entrega</span>
            <span class="value">{{summary.orders.delivering}}</span>
          </div>
          <div class="stat">
            <span class="label">Finalizados</span>
            <span class="value">{{summary.orders.completed}}</span>
          </div>
        </div>
        <div class="card-actions">
          <button mat-raised-button color="primary" [routerLink]="['/funcionario/pedidos']">
            Ver Pedidos
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Status do Estoque -->
    <mat-card class="summary-card" [ngClass]="{'warning': summary.stock.low_stock_count > 0}">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>inventory_2</mat-icon>
          <h2>Status do Estoque</h2>
        </div>
        <div class="card-body">
          <div class="stat">
            <span class="label">Total de Produtos</span>
            <span class="value">{{summary.stock.total_products}}</span>
          </div>
          <div class="stat">
            <span class="label">Estoque Baixo</span>
            <span class="value warning">{{summary.stock.low_stock_count}}</span>
          </div>
        </div>
        <div class="card-actions">
          <button mat-raised-button color="primary" [routerLink]="['/funcionario/estoque']">
            Gerenciar Estoque
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Dashboard Content - Employee (Simplificado) -->
  <div *ngIf="!loading && !error && summary && isEmployee" class="dashboard-content employee-dashboard">
    <!-- Card 1: Status do Caixa (Destaque) -->
    <mat-card class="status-card highlight-card" [ngClass]="{'open': summary.cash.is_open}">
      <mat-card-content>
        <div class="card-header">
          <mat-icon [class.open-icon]="summary.cash.is_open" [class.closed-icon]="!summary.cash.is_open">
            {{summary.cash.is_open ? 'point_of_sale' : 'lock'}}
          </mat-icon>
          <h2>Status do Caixa</h2>
        </div>
        <div class="card-body">
          <p class="status-large">{{summary.cash.is_open ? 'ABERTO' : 'FECHADO'}}</p>
        </div>
        <div class="card-actions">
          <button mat-raised-button 
                  [color]="summary.cash.is_open ? 'primary' : 'accent'" 
                  [routerLink]="['/funcionario/caixa']"
                  class="action-button-large">
            <mat-icon>{{summary.cash.is_open ? 'point_of_sale' : 'vpn_key'}}</mat-icon>
            {{summary.cash.is_open ? 'Gerenciar Caixa' : 'Abrir Caixa'}}
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Card 2: Atalho para Caixa -->
    <mat-card class="summary-card action-card">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>shopping_cart</mat-icon>
          <h2>Nova Venda</h2>
        </div>
        <div class="card-body">
          <p class="card-description">Inicie uma nova venda no PDV</p>
        </div>
        <div class="card-actions">
          <button mat-raised-button 
                  color="primary" 
                  [routerLink]="['/funcionario/caixa']"
                  class="action-button-large">
            <mat-icon>add_shopping_cart</mat-icon>
            Ir para o Caixa
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Card 3: Status dos Pedidos -->
    <mat-card class="summary-card">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>receipt_long</mat-icon>
          <h2>Status dos Pedidos</h2>
        </div>
        <div class="card-body">
          <div class="stat">
            <span class="label">Pendentes</span>
            <span class="value highlight">{{summary.orders.pending}}</span>
          </div>
          <div class="stat">
            <span class="label">Em Entrega</span>
            <span class="value">{{summary.orders.delivering}}</span>
          </div>
          <div class="stat">
            <span class="label">Finalizados</span>
            <span class="value">{{summary.orders.completed}}</span>
          </div>
        </div>
        <div class="card-actions">
          <button mat-raised-button color="primary" [routerLink]="['/funcionario/pedidos']">
            Ver Pedidos
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>