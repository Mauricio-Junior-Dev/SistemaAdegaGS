<div *ngIf="loading" class="dashboard-loading-spinner">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Carregando relat√≥rios...</p>
</div>

<div *ngIf="!loading" class="dashboard-container">
  
  <div class="page-header">
    <h1>Dashboard</h1>
  </div>

  <mat-tab-group (selectedTabChange)="onTabChange($event)" animationDuration="0ms">
    
    <mat-tab label="üìà Vis√£o Geral (Vendas)">
      <div class="tab-content-wrapper" *ngIf="overviewData">
        <div class="kpi-grid">
          <mat-card class="kpi-card sales">
            <mat-card-header>
              <mat-icon mat-card-avatar>show_chart</mat-icon>
              <mat-card-title>R$ {{ overviewData.kpis.total_sales | number:'1.2-2' }}</mat-card-title>
              <mat-card-subtitle>Faturamento Total</mat-card-subtitle>
            </mat-card-header>
          </mat-card>
          <mat-card class="kpi-card orders">
            <mat-card-header>
              <mat-icon mat-card-avatar>shopping_cart</mat-icon>
              <mat-card-title>{{ overviewData.kpis.total_orders }}</mat-card-title>
              <mat-card-subtitle>Pedidos Conclu√≠dos</mat-card-subtitle>
            </mat-card-header>
          </mat-card>
          <mat-card class="kpi-card ticket">
            <mat-card-header>
              <mat-icon mat-card-avatar>monetization_on</mat-icon>
              <mat-card-title>R$ {{ overviewData.kpis.avg_ticket | number:'1.2-2' }}</mat-card-title>
              <mat-card-subtitle>Ticket M√©dio</mat-card-subtitle>
            </mat-card-header>
          </mat-card>
        </div>
        
        <mat-card class="chart-card">
          <mat-card-header><mat-card-title>Vendas por Dia (R$)</mat-card-title></mat-card-header>
          <mat-card-content>
            <canvas id="salesChart"></canvas>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <mat-tab label="üçæ Produtos & Estoque">
      <div class="tab-content-wrapper" *ngIf="productData">
        <div class="kpi-grid-small">
          <mat-card class="kpi-card stock-value">
            <mat-card-header>
              <mat-icon mat-card-avatar>inventory_2</mat-icon>
              <mat-card-title>R$ {{ productData.kpi_stock_value | number:'1.2-2' }}</mat-card-title>
              <mat-card-subtitle>Valor Total do Estoque (Custo)</mat-card-subtitle>
            </mat-card-header>
          </mat-card>
        </div>
        
        <div class="table-grid-2-col">
          <mat-card>
            <mat-card-header><mat-card-title>Top 10 Produtos Mais Vendidos</mat-card-title></mat-card-header>
            <mat-card-content>
              <table class="simple-table">
                <thead><tr><th>Produto</th><th>Receita (R$)</th></tr></thead>
                <tbody>
                  <tr *ngFor="let item of productData.top_selling_table">
                    <td>{{ item.name }}</td>
                    <td>{{ item.total_revenue | number:'1.2-2' }}</td>
                  </tr>
                </tbody>
              </table>
            </mat-card-content>
          </mat-card>
          
          <mat-card>
            <mat-card-header><mat-card-title>Produtos em Baixo Estoque</mat-card-title></mat-card-header>
            <mat-card-content>
              <table class="simple-table">
                <thead><tr><th>Produto</th><th>Atual</th><th>M√≠nimo</th></tr></thead>
                <tbody>
                  <tr *ngFor="let item of productData.low_stock_table">
                    <td>{{ item.name }}</td>
                    <td>{{ item.current_stock }}</td>
                    <td>{{ item.min_stock }}</td>
                  </tr>
                </tbody>
              </table>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <mat-tab label="üë• Clientes">
      <div class="tab-content-wrapper" *ngIf="customerData">
        <div class="table-grid-2-col">
          <mat-card>
            <mat-card-header><mat-card-title>Novos Clientes vs. Recorrentes</mat-card-title></mat-card-header>
            <mat-card-content class="chart-pizza-container">
              <canvas id="customerChart"></canvas>
            </mat-card-content>
          </mat-card>

          <mat-card>
            <mat-card-header><mat-card-title>Top 5 Clientes VIP (por Gasto)</mat-card-title></mat-card-header>
            <mat-card-content>
              <table class="simple-table">
                <thead><tr><th>Nome</th><th>Total Gasto (R$)</th><th>Pedidos</th></tr></thead>
                <tbody>
                  <tr *ngFor="let customer of customerData.vip_table">
                    <td>{{ customer.name }}</td>
                    <td>{{ customer.total_spent | number:'1.2-2' }}</td>
                    <td>{{ customer.total_orders }}</td>
                  </tr>
                </tbody>
              </table>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

  </mat-tab-group>
</div>
