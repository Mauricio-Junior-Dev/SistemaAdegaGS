import{Zc as a,da as s,dd as l,ga as n,la as o,m as u}from"./chunk-QUOLBKI4.js";var h=class i{constructor(e){this.http=e;this.loadStoredAuth()}apiUrl=l.apiUrl;userSubject=new u(null);tokenSubject=new u(null);authStatus=new u(this.isAuthenticated());user$=this.userSubject.asObservable();token$=this.tokenSubject.asObservable();authStatus$=this.authStatus.asObservable();loadStoredAuth(){let e=localStorage.getItem("user"),t=localStorage.getItem("token");if(e&&t){let r=JSON.parse(e);this.userSubject.next(r),this.tokenSubject.next(t),this.authStatus.next(!0)}else this.authStatus.next(!1)}saveAuthInternal(e){localStorage.setItem("user",JSON.stringify(e.user)),localStorage.setItem("token",e.access_token),this.userSubject.next(e.user),this.tokenSubject.next(e.access_token),this.authStatus.next(!0)}register(e){return this.http.post(`${this.apiUrl}/register`,e).pipe(s(t=>this.saveAuthInternal(t)))}login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(s(t=>this.saveAuthInternal(t)))}logout(){return this.http.post(`${this.apiUrl}/logout`,{}).pipe(s(()=>{localStorage.removeItem("user"),localStorage.removeItem("token"),this.userSubject.next(null),this.tokenSubject.next(null),this.authStatus.next(!1)}))}updateProfile(e){return this.http.put(`${this.apiUrl}/user`,e).pipe(s(t=>{let r=t.user;localStorage.setItem("user",JSON.stringify(r)),this.userSubject.next(r)}))}getProfile(){return this.http.get(`${this.apiUrl}/user`)}isLoggedIn(){return!!this.tokenSubject.value}isAdmin(){return this.userSubject.value?.type==="admin"}isEmployee(){return this.userSubject.value?.type==="employee"}getToken(){return this.tokenSubject.value}getUser(){return this.userSubject.value}getCurrentUser(){return this.userSubject.value}saveAuth(e){this.saveAuthInternal(e)}isAuthenticated(){return!!localStorage.getItem("token")}getUserType(){return this.userSubject.value?.type||null}static \u0275fac=function(t){return new(t||i)(o(a))};static \u0275prov=n({token:i,factory:i.\u0275fac,providedIn:"root"})};export{h as a};
