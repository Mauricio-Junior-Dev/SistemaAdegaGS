import{a as k}from"./chunk-C55FFF5X.js";import{a as xt,b as St,c as Et}from"./chunk-6JEG3PPG.js";import{a as vt,b as Mt}from"./chunk-QMFDKZL2.js";import{a as Ye,b as Ze,c as et,d as tt,e as it,f as rt}from"./chunk-YM3SR4GW.js";import{a as pt,b as dt}from"./chunk-7P4XSV4R.js";import"./chunk-EYVEXPNH.js";import{a as nt,b as J}from"./chunk-ROER2RFV.js";import{a as Y,b as ct,c as ut,e as Z,f as ee,g as te,h as O}from"./chunk-NJG33T2I.js";import{a as ot,b as at,c as lt,d as mt}from"./chunk-W6W5QBSK.js";import{a as ft,b as gt,c as _t,d as ht,e as Ct}from"./chunk-O75GKIIZ.js";import"./chunk-F5X5MWHG.js";import{b as st}from"./chunk-AIXKBXYS.js";import{a as Te,c as Pe,d as Oe,e as ke}from"./chunk-DPGLS2YX.js";import{a as K,b as Je}from"./chunk-NXB367PQ.js";import{a as j,b as Re,c as Le,d as je,e as qe,f as ze,g as Ae,h as $e,i as Ge,j as He,k as Qe}from"./chunk-HB4FNUQQ.js";import"./chunk-MS4AQ6UA.js";import{d as H,h as Q,i as W}from"./chunk-U7CDANII.js";import{a as q,b as We,e as Xe,h as z,i as A,m as $,n as G}from"./chunk-RHC5ILWF.js";import"./chunk-XTFDZCPR.js";import{a as Ve,c as Be,g as Ne}from"./chunk-ZHIFTSGJ.js";import"./chunk-HTFI32IU.js";import"./chunk-C4KZ6I4Q.js";import{a as Ke,b as X}from"./chunk-EQKA6Y5K.js";import{b as D,c as T}from"./chunk-OBC24UR6.js";import"./chunk-CEPC3JHI.js";import"./chunk-FIIM6QS2.js";import{a as L,b as P}from"./chunk-6R7SEWBP.js";import{T as xe,Y as F,_ as U}from"./chunk-UVGQBODX.js";import{A as De,b as N,d as E,g as R,h as Se,j as Ee,k as be,m as we,p as Ie,v as ye,y as Fe,z as Ue}from"./chunk-M22BVTMS.js";import{$a as _,$b as le,Bb as i,Cb as t,Db as g,Eb as M,Fb as x,Hb as b,Hc as Me,Ic as I,Kb as c,Lb as C,Qb as ne,Rb as oe,Rc as y,Sb as ae,Vb as B,Wa as l,Wb as o,Xb as v,Yb as S,a as V,ac as me,b as _e,bc as se,ec as ve,gb as w,lb as d,sb as s,ta as u,tb as he,ua as f,ub as Ce}from"./chunk-AFGHNMPW.js";function Bt(a,e){a&1&&o(0,"Informa\xE7\xF5es B\xE1sicas")}function Nt(a,e){a&1&&(i(0,"mat-error"),o(1," Nome \xE9 obrigat\xF3rio "),t())}function Rt(a,e){a&1&&(i(0,"mat-error"),o(1," Tipo \xE9 obrigat\xF3rio "),t())}function Lt(a,e){a&1&&(i(0,"mat-error"),o(1," E-mail \xE9 obrigat\xF3rio "),t())}function jt(a,e){a&1&&(i(0,"mat-error"),o(1," E-mail inv\xE1lido "),t())}function qt(a,e){a&1&&(i(0,"mat-error"),o(1," E-mail j\xE1 cadastrado "),t())}function zt(a,e){a&1&&o(0,"Senha")}function At(a,e){a&1&&(i(0,"mat-error"),o(1," Senha \xE9 obrigat\xF3ria "),t())}function $t(a,e){a&1&&(i(0,"mat-error"),o(1," Senha deve ter no m\xEDnimo 8 caracteres "),t())}function Gt(a,e){a&1&&(i(0,"mat-error"),o(1," Confirma\xE7\xE3o de senha \xE9 obrigat\xF3ria "),t())}function Ht(a,e){a&1&&(i(0,"mat-error"),o(1," Senhas n\xE3o conferem "),t())}function Qt(a,e){a&1&&(i(0,"p",39),o(1," Deixe os campos em branco para manter a senha atual "),t())}function Wt(a,e){a&1&&o(0,"Endere\xE7o")}var ie=class a{constructor(e,n,r,m,p){this.fb=e;this.userService=n;this.snackBar=r;this.dialogRef=m;this.data=p;this.isEdit=!!p.user,this.basicInfoForm=this.fb.group({name:["",E.required],email:["",[E.required,E.email]],type:["customer",E.required],phone:[""],is_active:[!0]}),this.passwordForm=this.fb.group({password:["",this.isEdit?[]:[E.required,E.minLength(8)]],password_confirmation:["",this.isEdit?[]:[E.required]]},{validator:this.passwordMatchValidator}),this.addressForm=this.fb.group({street:[""],number:[""],complement:[""],neighborhood:[""],city:[""],state:[""],zipcode:[""]}),this.isEdit&&p.user&&(this.basicInfoForm.patchValue(p.user),p.user.address&&this.addressForm.patchValue(p.user.address))}basicInfoForm;passwordForm;addressForm;loading=!1;isEdit=!1;ngOnInit(){this.setupValidators()}setupValidators(){let e=this.basicInfoForm.get("email");e&&e.valueChanges.subscribe(n=>{n&&e.valid&&this.userService.validateEmail(n,this.data.user?.id).subscribe({next:r=>{r.valid||e.setErrors({emailExists:!0})}})})}passwordMatchValidator(e){let n=e.get("password"),r=e.get("password_confirmation");return!n||!r||n.value===r.value?null:{passwordMismatch:!0}}onSubmit(){if(this.basicInfoForm.valid&&this.passwordForm.valid&&this.addressForm.valid){this.loading=!0;let e=_e(V(V({},this.basicInfoForm.value),this.passwordForm.value),{address:Object.keys(this.addressForm.value).some(r=>this.addressForm.value[r])?this.addressForm.value:void 0});(this.isEdit?this.userService.updateUser(V({id:this.data.user.id},e)):this.userService.createUser(e)).subscribe({next:()=>{this.dialogRef.close(!0)},error:r=>{console.error("Erro ao salvar usu\xE1rio:",r),this.snackBar.open("Erro ao salvar usu\xE1rio","Fechar",{duration:3e3}),this.loading=!1}})}}static \u0275fac=function(n){return new(n||a)(_(Fe),_(k),_(D),_(Y),_(ct))};static \u0275cmp=w({type:a,selectors:[["app-user-form-dialog"]],decls:110,vars:24,consts:[["stepper",""],["mat-dialog-title",""],[3,"linear"],[3,"stepControl"],["matStepLabel",""],[3,"formGroup"],[1,"form-container"],[1,"form-row"],["appearance","outline"],["matInput","","formControlName","name","required",""],[4,"ngIf"],["formControlName","type","required",""],["value","admin"],["value","employee"],["value","customer"],["matInput","","formControlName","email","required","","type","email"],["matInput","","formControlName","phone","placeholder","(99) 99999-9999"],[1,"form-row","status-row"],["formControlName","is_active","color","primary"],[1,"step-actions"],["mat-button","","matStepperNext",""],[3,"stepControl","optional"],["matInput","","type","password","formControlName","password",3,"required"],["matInput","","type","password","formControlName","password_confirmation",3,"required"],["class","helper-text",4,"ngIf"],["mat-button","","matStepperPrevious",""],["optional","",3,"stepControl"],["matInput","","formControlName","zipcode","placeholder","00000-000"],["appearance","outline",1,"street-field"],["matInput","","formControlName","street"],["appearance","outline",1,"number-field"],["matInput","","formControlName","number"],["matInput","","formControlName","complement"],["matInput","","formControlName","neighborhood"],["matInput","","formControlName","city"],["matInput","","formControlName","state"],["mat-button","","color","primary",3,"click"],["align","end"],["mat-button","",3,"click","disabled"],[1,"helper-text"]],template:function(n,r){if(n&1){let m=b();i(0,"h2",1),o(1),t(),i(2,"mat-dialog-content")(3,"mat-stepper",2,0)(5,"mat-step",3),d(6,Bt,1,0,"ng-template",4),i(7,"form",5)(8,"div",6)(9,"div",7)(10,"mat-form-field",8)(11,"mat-label"),o(12,"Nome"),t(),g(13,"input",9),d(14,Nt,2,0,"mat-error",10),t(),i(15,"mat-form-field",8)(16,"mat-label"),o(17,"Tipo"),t(),i(18,"mat-select",11)(19,"mat-option",12),o(20,"Administrador"),t(),i(21,"mat-option",13),o(22,"Funcion\xE1rio"),t(),i(23,"mat-option",14),o(24,"Cliente"),t()(),d(25,Rt,2,0,"mat-error",10),t()(),i(26,"div",7)(27,"mat-form-field",8)(28,"mat-label"),o(29,"E-mail"),t(),g(30,"input",15),d(31,Lt,2,0,"mat-error",10)(32,jt,2,0,"mat-error",10)(33,qt,2,0,"mat-error",10),t(),i(34,"mat-form-field",8)(35,"mat-label"),o(36,"Telefone"),t(),g(37,"input",16),t()(),i(38,"div",17)(39,"mat-slide-toggle",18),o(40," Usu\xE1rio Ativo "),t()()(),i(41,"div",19)(42,"button",20),o(43,"Pr\xF3ximo"),t()()()(),i(44,"mat-step",21),d(45,zt,1,0,"ng-template",4),i(46,"form",5)(47,"div",6)(48,"div",7)(49,"mat-form-field",8)(50,"mat-label"),o(51,"Senha"),t(),g(52,"input",22),d(53,At,2,0,"mat-error",10)(54,$t,2,0,"mat-error",10),t(),i(55,"mat-form-field",8)(56,"mat-label"),o(57,"Confirmar Senha"),t(),g(58,"input",23),d(59,Gt,2,0,"mat-error",10)(60,Ht,2,0,"mat-error",10),t()(),d(61,Qt,2,0,"p",24),t(),i(62,"div",19)(63,"button",25),o(64,"Voltar"),t(),i(65,"button",20),o(66),t()()()(),i(67,"mat-step",26),d(68,Wt,1,0,"ng-template",4),i(69,"form",5)(70,"div",6)(71,"div",7)(72,"mat-form-field",8)(73,"mat-label"),o(74,"CEP"),t(),g(75,"input",27),t(),i(76,"mat-form-field",28)(77,"mat-label"),o(78,"Rua"),t(),g(79,"input",29),t(),i(80,"mat-form-field",30)(81,"mat-label"),o(82,"N\xFAmero"),t(),g(83,"input",31),t()(),i(84,"div",7)(85,"mat-form-field",8)(86,"mat-label"),o(87,"Complemento"),t(),g(88,"input",32),t(),i(89,"mat-form-field",8)(90,"mat-label"),o(91,"Bairro"),t(),g(92,"input",33),t()(),i(93,"div",7)(94,"mat-form-field",8)(95,"mat-label"),o(96,"Cidade"),t(),g(97,"input",34),t(),i(98,"mat-form-field",8)(99,"mat-label"),o(100,"Estado"),t(),g(101,"input",35),t()()(),i(102,"div",19)(103,"button",25),o(104,"Voltar"),t(),i(105,"button",36),c("click",function(){return u(m),f(r.onSubmit())}),o(106),t()()()()()(),i(107,"mat-dialog-actions",37)(108,"button",38),c("click",function(){return u(m),f(r.dialogRef.close())}),o(109," Cancelar "),t()()}if(n&2){let m,p,h,pe,de,ce,ue,fe,ge;l(),S("",r.isEdit?"Editar":"Novo"," Usu\xE1rio"),l(2),s("linear",!r.isEdit),l(2),s("stepControl",r.basicInfoForm),l(2),s("formGroup",r.basicInfoForm),l(7),s("ngIf",(m=r.basicInfoForm.get("name"))==null?null:m.hasError("required")),l(11),s("ngIf",(p=r.basicInfoForm.get("type"))==null?null:p.hasError("required")),l(6),s("ngIf",(h=r.basicInfoForm.get("email"))==null?null:h.hasError("required")),l(),s("ngIf",(pe=r.basicInfoForm.get("email"))==null?null:pe.hasError("email")),l(),s("ngIf",(de=r.basicInfoForm.get("email"))==null?null:de.hasError("emailExists")),l(11),s("stepControl",r.passwordForm)("optional",r.isEdit),l(2),s("formGroup",r.passwordForm),l(6),s("required",!r.isEdit),l(),s("ngIf",(ce=r.passwordForm.get("password"))==null?null:ce.hasError("required")),l(),s("ngIf",(ue=r.passwordForm.get("password"))==null?null:ue.hasError("minlength")),l(4),s("required",!r.isEdit),l(),s("ngIf",(fe=r.passwordForm.get("password_confirmation"))==null?null:fe.hasError("required")),l(),s("ngIf",(ge=r.passwordForm.get("password_confirmation"))==null?null:ge.hasError("passwordMismatch")),l(),s("ngIf",r.isEdit),l(5),v(r.isEdit?"Pr\xF3ximo":"Finalizar"),l(),s("stepControl",r.addressForm),l(2),s("formGroup",r.addressForm),l(37),S(" ",r.isEdit?"Salvar":"Criar"," "),l(2),s("disabled",r.loading)}},dependencies:[y,I,De,be,N,R,Se,ye,we,Ie,O,Z,te,ee,U,F,A,z,q,We,G,$,W,Q,H,Mt,vt,J,P,X,T,rt,Ze,Ye,et,tt,it,st],styles:["mat-dialog-content[_ngcontent-%COMP%]{max-height:80vh;overflow-y:auto}.form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:16px 0}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px}.form-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}.street-field[_ngcontent-%COMP%]{flex:2}.number-field[_ngcontent-%COMP%]{flex:.5}.status-row[_ngcontent-%COMP%]{margin-top:8px}.helper-text[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}.step-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px;margin-top:16px}@media (max-width: 600px){.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:0}.preview[_ngcontent-%COMP%]{width:80px;height:80px}}"]})};function Kt(a,e){a&1&&(M(0),i(1,"p"),o(2,"Arraste e solte seu arquivo aqui"),t(),i(3,"p"),o(4,"ou"),t(),i(5,"p"),o(6,"clique para selecionar"),t(),i(7,"small"),o(8,"Formatos aceitos: CSV, XLSX"),t(),x())}function Jt(a,e){if(a&1&&(M(0),i(1,"p"),o(2),t(),i(3,"small"),o(4),t(),x()),a&2){let n=C();l(2),v(n.selectedFile.name),l(2),v(n.formatFileSize(n.selectedFile.size))}}function Yt(a,e){if(a&1&&(i(0,"mat-list-item")(1,"mat-icon",16),o(2,"error"),t(),i(3,"span",17),o(4),t()()),a&2){let n=e.$implicit;l(4),v(n)}}function Zt(a,e){if(a&1&&(i(0,"div",14)(1,"h3"),o(2,"Erros na Importa\xE7\xE3o"),t(),i(3,"mat-list"),d(4,Yt,5,1,"mat-list-item",15),t()()),a&2){let n=C();l(4),s("ngForOf",n.errors)}}function ei(a,e){a&1&&g(0,"mat-progress-bar",18)}var re=class a{constructor(e,n,r){this.dialogRef=e;this.userService=n;this.snackBar=r}selectedFile=null;isDragging=!1;importing=!1;errors=[];onDragOver(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!0}onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!1}onDrop(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!1;let n=e.dataTransfer?.files;n?.length&&this.handleFile(n[0])}onFileSelected(e){let n=e.target.files?.[0];n&&this.handleFile(n)}handleFile(e){if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(e.type)){this.snackBar.open("Formato de arquivo inv\xE1lido. Use CSV ou XLSX.","Fechar",{duration:3e3});return}this.selectedFile=e,this.errors=[]}importFile(){this.selectedFile&&(this.importing=!0,this.errors=[],this.userService.importUsers(this.selectedFile).subscribe({next:e=>{e.errors.length>0?(this.errors=e.errors,this.snackBar.open(`Importa\xE7\xE3o conclu\xEDda com ${e.errors.length} erros.`,"Fechar",{duration:5e3})):(this.snackBar.open(`${e.imported} usu\xE1rios importados com sucesso!`,"Fechar",{duration:3e3}),this.dialogRef.close(!0)),this.importing=!1},error:e=>{console.error("Erro na importa\xE7\xE3o:",e),this.snackBar.open("Erro ao importar usu\xE1rios","Fechar",{duration:3e3}),this.importing=!1}}))}downloadTemplate(e){this.userService.exportUsers(e).subscribe({next:n=>{let r=window.URL.createObjectURL(n),m=document.createElement("a");m.href=r,m.download=`template_usuarios.${e}`,m.click(),window.URL.revokeObjectURL(r)},error:n=>{console.error("Erro ao baixar template:",n),this.snackBar.open("Erro ao baixar template","Fechar",{duration:3e3})}})}getUploadIcon(){return this.errors.length>0?"error":this.selectedFile?"description":"cloud_upload"}formatFileSize(e){if(e===0)return"0 Bytes";let n=1024,r=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,m)).toFixed(2))+" "+r[m]}static \u0275fac=function(n){return new(n||a)(_(Y),_(k),_(D))};static \u0275cmp=w({type:a,selectors:[["app-user-import-dialog"]],decls:30,vars:13,consts:[["fileInput",""],["mat-dialog-title",""],[1,"import-container"],[1,"upload-area",3,"dragover","dragleave","drop","click"],["type","file","accept",".csv,.xlsx",2,"display","none",3,"change"],[1,"upload-text"],[4,"ngIf"],["class","errors-section",4,"ngIf"],[1,"template-section"],["mat-stroked-button","",3,"click"],["mode","indeterminate",4,"ngIf"],["align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"errors-section"],[4,"ngFor","ngForOf"],["matListItemIcon","","color","warn"],["matListItemTitle",""],["mode","indeterminate"]],template:function(n,r){if(n&1){let m=b();i(0,"h2",1),o(1,"Importar Usu\xE1rios"),t(),i(2,"mat-dialog-content")(3,"div",2)(4,"div",3),c("dragover",function(h){return u(m),f(r.onDragOver(h))})("dragleave",function(h){return u(m),f(r.onDragLeave(h))})("drop",function(h){return u(m),f(r.onDrop(h))})("click",function(){u(m);let h=B(6);return f(h.click())}),i(5,"input",4,0),c("change",function(h){return u(m),f(r.onFileSelected(h))}),t(),i(7,"mat-icon"),o(8),t(),i(9,"div",5),d(10,Kt,9,0,"ng-container",6)(11,Jt,5,2,"ng-container",6),t()(),d(12,Zt,5,1,"div",7),i(13,"div",8)(14,"p"),o(15,"Baixe nosso template para importa\xE7\xE3o:"),t(),i(16,"button",9),c("click",function(){return u(m),f(r.downloadTemplate("xlsx"))}),i(17,"mat-icon"),o(18,"download"),t(),o(19," Template XLSX "),t(),i(20,"button",9),c("click",function(){return u(m),f(r.downloadTemplate("csv"))}),i(21,"mat-icon"),o(22,"download"),t(),o(23," Template CSV "),t()(),d(24,ei,1,0,"mat-progress-bar",10),t()(),i(25,"mat-dialog-actions",11)(26,"button",12),c("click",function(){return u(m),f(r.dialogRef.close())}),o(27," Cancelar "),t(),i(28,"button",13),c("click",function(){return u(m),f(r.importFile())}),o(29," Importar "),t()()}n&2&&(l(4),Ce("drag-over",r.isDragging)("has-file",r.selectedFile)("has-errors",r.errors.length>0),l(4),v(r.getUploadIcon()),l(2),s("ngIf",!r.selectedFile),l(),s("ngIf",r.selectedFile),l(),s("ngIf",r.errors.length>0),l(12),s("ngIf",r.importing),l(2),s("disabled",r.importing),l(2),s("disabled",!r.selectedFile||r.importing))},dependencies:[y,Me,I,O,Z,te,ee,U,F,P,L,dt,pt,T,Ct,_t,ht,gt,ft],styles:[".import-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;padding:16px 0}.upload-area[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:8px;padding:32px;text-align:center;cursor:pointer;transition:all .2s ease}.upload-area.drag-over[_ngcontent-%COMP%]{border-color:#3f51b5;background-color:#3f51b50d}.upload-area.has-file[_ngcontent-%COMP%]{border-style:solid;border-color:#4caf50;background-color:#4caf500d}.upload-area.has-errors[_ngcontent-%COMP%]{border-color:#f44336;background-color:#f443360d}.upload-area[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:#666;margin-bottom:16px}.upload-text[_ngcontent-%COMP%]{color:#666}.upload-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0}.upload-text[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#999}.errors-section[_ngcontent-%COMP%]{background-color:#fff3f2;border-radius:8px;padding:16px}.errors-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#d32f2f;margin:0 0 16px;font-size:16px}.template-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.template-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666}@media (max-width: 600px){.template-section[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}"]})};var ti=()=>[10,25,50,100];function ii(a,e){a&1&&(i(0,"div",20),g(1,"mat-spinner",21),i(2,"p"),o(3,"Carregando usu\xE1rios..."),t()())}function ri(a,e){a&1&&(i(0,"th",37),o(1,"Nome"),t())}function ni(a,e){if(a&1&&(i(0,"td",38)(1,"div",39)(2,"span",40),o(3),t(),i(4,"span",41),o(5),t()()()),a&2){let n=e.$implicit;l(3),v(n.name),l(2),v(n.email)}}function oi(a,e){a&1&&(i(0,"th",37),o(1,"E-mail"),t())}function ai(a,e){a&1&&(i(0,"mat-icon",44),o(1," warning "),t())}function li(a,e){if(a&1&&(i(0,"td",38)(1,"div",42),o(2),d(3,ai,2,0,"mat-icon",43),t()()),a&2){let n=e.$implicit;l(2),S(" ",n.email," "),l(),s("ngIf",!n.email_verified_at)}}function mi(a,e){a&1&&(i(0,"th",37),o(1,"Tipo"),t())}function si(a,e){if(a&1&&(i(0,"td",38)(1,"mat-chip"),o(2),t()()),a&2){let n=e.$implicit,r=C(2);l(),he("background-color",r.getTypeColor(n.type))("color","white"),l(),S(" ",r.getTypeLabel(n.type)," ")}}function pi(a,e){a&1&&(i(0,"th",37),o(1,"\xDAltimo Acesso"),t())}function di(a,e){if(a&1&&(i(0,"td",38),o(1),t()),a&2){let n=e.$implicit,r=C(2);l(),S(" ",r.formatDate(n.last_login_at)," ")}}function ci(a,e){a&1&&(i(0,"th",45),o(1,"Status"),t())}function ui(a,e){if(a&1&&(i(0,"td",38)(1,"mat-chip",46),o(2),t()()),a&2){let n=e.$implicit;l(),s("color",n.is_active?"primary":"warn"),l(),S(" ",n.is_active?"Ativo":"Inativo"," ")}}function fi(a,e){a&1&&(i(0,"th",45),o(1,"A\xE7\xF5es"),t())}function gi(a,e){if(a&1){let n=b();i(0,"td",38)(1,"button",47)(2,"mat-icon"),o(3,"more_vert"),t()(),i(4,"mat-menu",null,0)(6,"button",48),c("click",function(){let m=u(n).$implicit,p=C(2);return f(p.openUserDialog(m))}),i(7,"mat-icon"),o(8,"edit"),t(),i(9,"span"),o(10,"Editar"),t()(),i(11,"button",48),c("click",function(){let m=u(n).$implicit,p=C(2);return f(p.toggleStatus(m))}),i(12,"mat-icon"),o(13),t(),i(14,"span"),o(15),t()(),i(16,"button",49),c("click",function(){let m=u(n).$implicit,p=C(2);return f(p.deleteUser(m))}),i(17,"mat-icon"),o(18,"delete"),t(),i(19,"span"),o(20,"Excluir"),t()()()()}if(a&2){let n=e.$implicit,r=B(5);l(),s("matMenuTriggerFor",r),l(12),v(n.is_active?"visibility_off":"visibility"),l(2),v(n.is_active?"Desativar":"Ativar"),l(),s("disabled",n.type==="admin")}}function _i(a,e){a&1&&g(0,"tr",50)}function hi(a,e){a&1&&g(0,"tr",51)}function Ci(a,e){a&1&&(i(0,"div",52)(1,"mat-icon"),o(2,"people"),t(),i(3,"p"),o(4,"Nenhum usu\xE1rio encontrado"),t()())}function vi(a,e){if(a&1){let n=b();i(0,"mat-card",22)(1,"mat-card-content")(2,"table",23),c("matSortChange",function(m){u(n);let p=C();return f(p.onSortChange(m))}),M(3,24),d(4,ri,2,0,"th",25)(5,ni,6,2,"td",26),x(),M(6,27),d(7,oi,2,0,"th",25)(8,li,4,2,"td",26),x(),M(9,28),d(10,mi,2,0,"th",25)(11,si,3,5,"td",26),x(),M(12,29),d(13,pi,2,0,"th",25)(14,di,2,1,"td",26),x(),M(15,30),d(16,ci,2,0,"th",31)(17,ui,3,2,"td",26),x(),M(18,32),d(19,fi,2,0,"th",31)(20,gi,21,4,"td",26),x(),d(21,_i,1,0,"tr",33)(22,hi,1,0,"tr",34),t(),d(23,Ci,5,0,"div",35),i(24,"mat-paginator",36),c("page",function(m){u(n);let p=C();return f(p.onPageChange(m))}),t()()()}if(a&2){let n=C();l(2),s("dataSource",n.users),l(19),s("matHeaderRowDef",n.displayedColumns),l(),s("matRowDefColumns",n.displayedColumns),l(),s("ngIf",n.users.length===0),l(),s("length",n.totalItems)("pageSize",n.pageSize)("pageIndex",n.currentPage)("pageSizeOptions",ve(8,ti))}}var Tt=class a{constructor(e,n,r){this.userService=e;this.dialog=n;this.snackBar=r}table;paginator;users=[];loading=!0;totalItems=0;pageSize=10;currentPage=0;searchTerm="";selectedType=void 0;showInactive=!1;displayedColumns=["name","email","type","last_login","status","actions"];ngOnInit(){this.loadUsers()}loadUsers(){this.loading=!0,this.userService.getUsers({page:this.currentPage+1,per_page:this.pageSize,search:this.searchTerm,type:this.selectedType,is_active:!this.showInactive}).subscribe({next:e=>{this.users=e.data,this.totalItems=e.total,this.loading=!1},error:e=>{console.error("Erro ao carregar usu\xE1rios:",e),this.snackBar.open("Erro ao carregar usu\xE1rios","Fechar",{duration:3e3}),this.loading=!1}})}onSearch(e){let n=e.target;this.searchTerm=n.value,this.currentPage=0,this.loadUsers()}onTypeChange(){this.currentPage=0,this.loadUsers()}onPageChange(e){this.pageSize=e.pageSize,this.currentPage=e.pageIndex,this.loadUsers()}onSortChange(e){}toggleFilters(e){switch(e){case"inactive":this.showInactive=!this.showInactive;break}this.currentPage=0,this.loadUsers()}openUserDialog(e){this.dialog.open(ie,{width:"800px",data:{user:e}}).afterClosed().subscribe(r=>{r&&this.loadUsers()})}openImportDialog(){this.dialog.open(re,{width:"600px"}).afterClosed().subscribe(n=>{n&&this.loadUsers()})}exportUsers(e){this.userService.exportUsers(e).subscribe({next:n=>{let r=window.URL.createObjectURL(n),m=document.createElement("a");m.href=r,m.download=`usuarios_${new Date().toISOString().split("T")[0]}.${e}`,m.click(),window.URL.revokeObjectURL(r)},error:n=>{console.error("Erro ao exportar usu\xE1rios:",n),this.snackBar.open("Erro ao exportar usu\xE1rios","Fechar",{duration:3e3})}})}toggleStatus(e){let n=e.is_active?"desativar":"ativar",r=!e.is_active;this.userService.updateStatus(e.id,r).subscribe({next:()=>{e.is_active=r,this.snackBar.open(`Usu\xE1rio ${n==="ativar"?"ativado":"desativado"} com sucesso!`,"Fechar",{duration:3e3})},error:m=>{console.error(`Erro ao ${n} usu\xE1rio:`,m),this.snackBar.open(`Erro ao ${n} usu\xE1rio`,"Fechar",{duration:3e3})}})}deleteUser(e){confirm(`Tem certeza que deseja excluir o usu\xE1rio ${e.name}?`)&&this.userService.deleteUser(e.id).subscribe({next:()=>{this.loadUsers(),this.snackBar.open("Usu\xE1rio exclu\xEDdo com sucesso!","Fechar",{duration:3e3})},error:n=>{console.error("Erro ao excluir usu\xE1rio:",n),this.snackBar.open("Erro ao excluir usu\xE1rio","Fechar",{duration:3e3})}})}getTypeColor(e){switch(e){case"admin":return"#f44336";case"employee":return"#2196f3";case"customer":return"#4caf50";default:return"#9e9e9e"}}formatDate(e){return e?new Date(e).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}getTypeLabel(e){switch(e){case"admin":return"Administrador";case"employee":return"Funcion\xE1rio";case"customer":return"Cliente";default:return e}}static \u0275fac=function(n){return new(n||a)(_(k),_(ut),_(D))};static \u0275cmp=w({type:a,selectors:[["app-usuarios"]],viewQuery:function(n,r){if(n&1&&(ne(j,5),ne(K,5)),n&2){let m;oe(m=ae())&&(r.table=m.first),oe(m=ae())&&(r.paginator=m.first)}},decls:36,vars:6,consts:[["userMenu","matMenu"],[1,"usuarios-container"],[1,"usuarios-header"],[1,"header-actions"],["mat-raised-button","","color","accent",3,"click"],[1,"filters-card"],[1,"filters-container"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Nome, e-mail ou telefone",3,"ngModelChange","keyup","ngModel"],["matSuffix",""],["appearance","outline"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value"],["value","admin"],["value","employee"],["value","customer"],[1,"filter-toggles"],[3,"selectionChange","selected"],["class","loading-container",4,"ngIf"],["class","table-card",4,"ngIf"],[1,"loading-container"],["diameter","50"],[1,"table-card"],["mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","email"],["matColumnDef","type"],["matColumnDef","last_login"],["matColumnDef","status"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","empty-state",4,"ngIf"],[3,"page","length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"user-info"],[1,"name"],[1,"email"],[1,"email-info"],["color","warn","matTooltip","E-mail n\xE3o verificado","class","verification-icon",4,"ngIf"],["color","warn","matTooltip","E-mail n\xE3o verificado",1,"verification-icon"],["mat-header-cell",""],["selected","",3,"color"],["mat-icon-button","","aria-label","A\xE7\xF5es",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","","color","warn",3,"click","disabled"],["mat-header-row",""],["mat-row",""],[1,"empty-state"]],template:function(n,r){n&1&&(i(0,"div",1)(1,"div",2)(2,"h1"),o(3,"Usu\xE1rios"),t(),i(4,"div",3)(5,"button",4),c("click",function(){return r.openUserDialog()}),i(6,"mat-icon"),o(7,"person_add"),t(),o(8," Novo Usu\xE1rio "),t()()(),i(9,"mat-card",5)(10,"mat-card-content")(11,"div",6)(12,"mat-form-field",7)(13,"mat-label"),o(14,"Buscar usu\xE1rios"),t(),i(15,"input",8),se("ngModelChange",function(p){return me(r.searchTerm,p)||(r.searchTerm=p),p}),c("keyup",function(p){return r.onSearch(p)}),t(),i(16,"mat-icon",9),o(17,"search"),t()(),i(18,"mat-form-field",10)(19,"mat-label"),o(20,"Tipo"),t(),i(21,"mat-select",11),se("ngModelChange",function(p){return me(r.selectedType,p)||(r.selectedType=p),p}),c("selectionChange",function(){return r.onTypeChange()}),i(22,"mat-option",12),o(23,"Todos"),t(),i(24,"mat-option",13),o(25,"Administradores"),t(),i(26,"mat-option",14),o(27,"Funcion\xE1rios"),t(),i(28,"mat-option",15),o(29,"Clientes"),t()()(),i(30,"div",16)(31,"mat-chip-listbox")(32,"mat-chip-option",17),c("selectionChange",function(){return r.toggleFilters("inactive")}),o(33," Mostrar Inativos "),t()()()()()(),d(34,ii,4,0,"div",18)(35,vi,25,9,"mat-card",19),t()),n&2&&(l(15),le("ngModel",r.searchTerm),l(6),le("ngModel",r.selectedType),l(),s("value",null),l(10),s("selected",r.showInactive),l(2),s("ngIf",r.loading),l(),s("ngIf",!r.loading))},dependencies:[y,I,Ue,N,R,Ee,O,U,F,xe,P,L,Ne,Ve,Be,A,z,q,Xe,G,$,W,Q,H,mt,ot,lt,at,Qe,j,Le,Ae,je,Re,$e,qe,ze,Ge,He,Et,xt,St,Je,K,ke,Pe,Te,Oe,J,nt,T,X,Ke],styles:[".usuarios-container[_ngcontent-%COMP%]{padding:20px}.usuarios-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.usuarios-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;color:#333}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.filters-card[_ngcontent-%COMP%]{margin-bottom:20px}.filters-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;align-items:center}.search-field[_ngcontent-%COMP%]{flex:1;min-width:300px}.filter-toggles[_ngcontent-%COMP%]{display:flex;gap:10px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:20px;color:#666}.table-card[_ngcontent-%COMP%]{overflow:hidden}table[_ngcontent-%COMP%]{width:100%}.mat-column-actions[_ngcontent-%COMP%]{width:80px;text-align:center}.mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.user-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:#f5f5f5}.user-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-info[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:500}.user-info[_ngcontent-%COMP%]   .email[_ngcontent-%COMP%]{font-size:12px;color:#666}.email-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.verification-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;color:#666}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}@media (max-width: 960px){.usuarios-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:16px}.header-actions[_ngcontent-%COMP%]{justify-content:flex-end}.filters-container[_ngcontent-%COMP%]{flex-direction:column}.search-field[_ngcontent-%COMP%]{width:100%}.filter-toggles[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}.mat-column-avatar[_ngcontent-%COMP%], .mat-column-last_login[_ngcontent-%COMP%]{display:none}}[_nghost-%COMP%]     .mat-mdc-card{border-radius:8px;box-shadow:0 2px 4px #0000001a}[_nghost-%COMP%]     .mat-mdc-card-header{padding:16px}[_nghost-%COMP%]     .mat-mdc-card-content{padding:0 16px 16px}.mat-mdc-row[_ngcontent-%COMP%]{transition:background-color .2s ease}.user-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transition:transform .2s ease}.user-avatar[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.1)}"]})};export{Tt as UsuariosComponent};
