import{Yc as u,Zc as p,a as i,b as n,dd as m,ga as c,la as h,r as o}from"./chunk-QUOLBKI4.js";var l=class e{constructor(t){this.http=t;this.loadFromStorage()}apiUrl=`${m.apiUrl}/cash`;storageKey="cash_data";mockData={status:{is_open:!1,opened_at:void 0,opened_by:void 0,initial_amount:0,current_amount:0},transactions:[]};useMock=!1;loadFromStorage(){try{let t=localStorage.getItem(this.storageKey);if(t){let a=JSON.parse(t);this.mockData={status:a.status||this.mockData.status,transactions:a.transactions||this.mockData.transactions}}}catch(t){console.error("Erro ao carregar dados do caixa do localStorage:",t)}}saveToStorage(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.mockData))}catch(t){console.error("Erro ao salvar dados do caixa no localStorage:",t)}}openCash(t){return this.useMock?(this.mockData.status={is_open:!0,opened_at:new Date().toISOString(),opened_by:"Funcion\xE1rio",initial_amount:t,current_amount:t},this.saveToStorage(),o(this.mockData.status)):this.http.post(`${this.apiUrl}/open`,{initial_amount:t})}closeCash(){if(this.useMock){let t={date:new Date().toISOString(),opening_balance:this.mockData.status.initial_amount,closing_balance:this.mockData.status.current_amount,total_income:this.mockData.transactions.filter(a=>a.type==="entrada").reduce((a,s)=>a+s.amount,0),total_outcome:this.mockData.transactions.filter(a=>a.type==="saida").reduce((a,s)=>a+s.amount,0),transactions:this.mockData.transactions};return this.mockData.status.is_open=!1,this.mockData.transactions=[],this.saveToStorage(),o(t)}return this.http.post(`${this.apiUrl}/close`,{})}addTransaction(t){if(this.useMock){let a=n(i({},t),{id:Math.random().toString(36).substr(2,9),created_at:new Date().toISOString(),created_by:"Funcion\xE1rio"});return this.mockData.transactions.push(a),this.mockData.status.current_amount+=t.type==="entrada"?t.amount:-t.amount,this.saveToStorage(),o(a)}return this.http.post(`${this.apiUrl}/transaction`,t)}getStatus(){return this.useMock?o(this.mockData.status):this.http.get(`${this.apiUrl}/status`)}getTodayTransactions(){return this.useMock?o(this.mockData.transactions):this.http.get(`${this.apiUrl}/today`)}generateReport(t){if(this.useMock)return o({date:t||new Date().toISOString(),opening_balance:this.mockData.status.initial_amount,closing_balance:this.mockData.status.current_amount,total_income:this.mockData.transactions.filter(s=>s.type==="entrada").reduce((s,r)=>s+r.amount,0),total_outcome:this.mockData.transactions.filter(s=>s.type==="saida").reduce((s,r)=>s+r.amount,0),transactions:this.mockData.transactions});let a=t?new u().set("date",t):void 0;return this.http.get(`${this.apiUrl}/report`,{params:a})}static \u0275fac=function(a){return new(a||e)(h(p))};static \u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"})};export{l as a};
