import{b as N}from"./chunk-ZEYMQFYA.js";import"./chunk-6VK4WP7F.js";import{a as j}from"./chunk-FDSNYN5C.js";import"./chunk-L7YZATBO.js";import{a as k}from"./chunk-JEC3ZXLW.js";import{A as R,b as F,d as g,g as I,h as A,k as L,m as T,p as G,y as z}from"./chunk-7Q6V27MS.js";import{a as O,c as M,d as E,h as w}from"./chunk-UIAL7XLZ.js";import{$a as m,Bb as i,Cb as r,Db as v,Ic as x,Kb as C,Lb as f,Rc as P,Wa as l,Wb as s,Yb as S,f as b,gb as y,lb as u,sb as d,ub as _}from"./chunk-QUOLBKI4.js";function U(o,n){if(o&1&&(i(0,"div",19),s(1),r()),o&2){let t=f();l(),S(" ",t.error," ")}}function q(o,n){o&1&&(i(0,"span"),s(1,"E-mail \xE9 obrigat\xF3rio"),r())}function B(o,n){o&1&&(i(0,"span"),s(1,"E-mail inv\xE1lido"),r())}function V(o,n){if(o&1&&(i(0,"div",20),u(1,q,2,0,"span",12)(2,B,2,0,"span",12),r()),o&2){let t,e,a=f();l(),d("ngIf",(t=a.loginForm.get("email"))==null||t.errors==null?null:t.errors.required),l(),d("ngIf",(e=a.loginForm.get("email"))==null||e.errors==null?null:e.errors.email)}}function W(o,n){o&1&&(i(0,"span"),s(1,"Senha \xE9 obrigat\xF3ria"),r())}function J(o,n){o&1&&(i(0,"span"),s(1,"Senha deve ter no m\xEDnimo 8 caracteres"),r())}function Y(o,n){if(o&1&&(i(0,"div",20),u(1,W,2,0,"span",12)(2,J,2,0,"span",12),r()),o&2){let t,e,a=f();l(),d("ngIf",(t=a.loginForm.get("password"))==null||t.errors==null?null:t.errors.required),l(),d("ngIf",(e=a.loginForm.get("password"))==null||e.errors==null?null:e.errors.minlength)}}function H(o,n){o&1&&(i(0,"span"),s(1,"Entrar"),r())}function K(o,n){o&1&&(i(0,"span"),s(1,"Entrando..."),r())}var D=class o{constructor(n,t,e,a,c,p){this.fb=n;this.authService=t;this.socialAuthService=e;this.orderPollingService=a;this.router=c;this.route=p;this.loginForm=this.fb.group({email:["",[g.required,g.email]],password:["",[g.required,g.minLength(8)]]})}loginForm;loading=!1;error=null;returnUrl="/";ngOnInit(){this.returnUrl=this.route.snapshot.queryParams.returnUrl||"/",this.initializeSocialAuth(),window.addEventListener("social-auth-success",this.handleSocialAuthSuccess.bind(this)),window.addEventListener("social-auth-error",this.handleSocialAuthError.bind(this)),window.handleGoogleResponse=n=>{this.handleGoogleResponse(n)}}ngOnDestroy(){window.removeEventListener("social-auth-success",this.handleSocialAuthSuccess.bind(this)),window.removeEventListener("social-auth-error",this.handleSocialAuthError.bind(this))}initializeSocialAuth(){return b(this,null,function*(){try{yield this.socialAuthService.initializeGoogle()}catch(n){console.error("Erro ao inicializar autentica\xE7\xE3o social:",n)}})}loginWithGoogle(){this.loading=!0,this.error=null,this.socialAuthService.loginWithGoogle()}handleSocialAuthSuccess(n){let t=n.detail;this.authService.saveAuth(t),t.user.type==="employee"&&(console.log("[LoginComponent] Iniciando polling de pedidos para funcion\xE1rio (social auth)"),this.orderPollingService.startPolling());let e=t.user.type,a=this.returnUrl;if(this.returnUrl==="/")switch(e){case"admin":a="/admin";break;case"employee":a="/funcionario";break;case"customer":a="/";break}this.router.navigate([a]),this.loading=!1}handleSocialAuthError(n){this.error="Erro na autentica\xE7\xE3o social. Tente novamente.",this.loading=!1}handleGoogleResponse(n){try{let t=JSON.parse(atob(n.credential.split(".")[1]));this.loading=!0,this.error=null,this.socialAuthService.sendSocialAuthToBackend("google",{token:n.credential,email:t.email,name:t.name,picture:t.picture}).subscribe({next:e=>{this.authService.saveAuth(e),e.user.type==="employee"&&(console.log("[LoginComponent] Iniciando polling de pedidos para funcion\xE1rio (Google)"),this.orderPollingService.startPolling());let a=e.user.type,c=this.returnUrl;if(this.returnUrl==="/")switch(a){case"admin":c="/admin";break;case"employee":c="/funcionario";break;case"customer":c="/";break}this.router.navigate([c]),this.loading=!1},error:e=>{console.error("Erro na autentica\xE7\xE3o social:",e),this.error="Erro na autentica\xE7\xE3o social. Tente novamente.",this.loading=!1}})}catch(t){console.error("Erro ao processar token do Google:",t),this.error="Erro ao processar login com Google",this.loading=!1}}onSubmit(){this.loginForm.invalid||(this.loading=!0,this.error=null,this.authService.login(this.loginForm.value).subscribe({next:n=>{n.user.type==="employee"&&(console.log("[LoginComponent] Iniciando polling de pedidos para funcion\xE1rio"),this.orderPollingService.startPolling());let t=n.user.type,e=this.returnUrl;if(this.returnUrl==="/")switch(t){case"admin":e="/admin";break;case"employee":e="/funcionario";break;case"customer":e="/";break}this.router.navigate([e])},error:n=>{this.error=n.error.message||"Erro ao fazer login",this.loading=!1}}))}static \u0275fac=function(t){return new(t||o)(m(z),m(k),m(j),m(N),m(M),m(O))};static \u0275cmp=y({type:o,selectors:[["app-login"]],decls:33,vars:11,consts:[[1,"auth-container"],[1,"auth-card"],[1,"auth-header"],[1,"auth-form",3,"ngSubmit","formGroup"],["class","error-message",4,"ngIf"],[1,"form-group"],["for","email"],["type","email","id","email","formControlName","email","placeholder","Seu e-mail"],["class","error-hint",4,"ngIf"],["for","password"],["type","password","id","password","formControlName","password","placeholder","Sua senha"],["type","submit",1,"submit-button",3,"disabled"],[4,"ngIf"],[1,"social-divider"],[1,"social-login"],["id","g_id_onload","data-client_id","908499908342-sjub85e0ld97i2438vu517tu3qdebd66.apps.googleusercontent.com","data-callback","handleGoogleResponse"],["data-type","standard","data-theme","outline","data-size","large",1,"g_id_signin"],[1,"auth-links"],["routerLink","/register"],[1,"error-message"],[1,"error-hint"]],template:function(t,e){if(t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),s(4,"Login"),r(),i(5,"p"),s(6,"Entre para fazer seus pedidos"),r()(),i(7,"form",3),C("ngSubmit",function(){return e.onSubmit()}),u(8,U,2,1,"div",4),i(9,"div",5)(10,"label",6),s(11,"E-mail"),r(),v(12,"input",7),u(13,V,3,2,"div",8),r(),i(14,"div",5)(15,"label",9),s(16,"Senha"),r(),v(17,"input",10),u(18,Y,3,2,"div",8),r(),i(19,"button",11),u(20,H,2,0,"span",12)(21,K,2,0,"span",12),r(),i(22,"div",13)(23,"span"),s(24,"ou"),r()(),i(25,"div",14),v(26,"div",15)(27,"div",16),r(),i(28,"div",17)(29,"p"),s(30,"Ainda n\xE3o tem uma conta? "),i(31,"a",18),s(32,"Cadastre-se"),r()()()()()()),t&2){let a,c,p,h;l(7),d("formGroup",e.loginForm),l(),d("ngIf",e.error),l(4),_("invalid",((a=e.loginForm.get("email"))==null?null:a.invalid)&&((a=e.loginForm.get("email"))==null?null:a.touched)),l(),d("ngIf",((c=e.loginForm.get("email"))==null?null:c.invalid)&&((c=e.loginForm.get("email"))==null?null:c.touched)),l(4),_("invalid",((p=e.loginForm.get("password"))==null?null:p.invalid)&&((p=e.loginForm.get("password"))==null?null:p.touched)),l(),d("ngIf",((h=e.loginForm.get("password"))==null?null:h.invalid)&&((h=e.loginForm.get("password"))==null?null:h.touched)),l(),d("disabled",e.loginForm.invalid||e.loading),l(),d("ngIf",!e.loading),l(),d("ngIf",e.loading)}},dependencies:[P,x,w,E,R,L,F,I,A,T,G],styles:['.auth-container[_ngcontent-%COMP%]{min-height:calc(100vh - 64px);display:flex;align-items:center;justify-content:center;padding:2rem;background-color:var(--background)}.auth-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background:var(--white);border-radius:var(--border-radius-md);box-shadow:0 2px 4px #0000001a;padding:2rem}.auth-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.auth-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;color:var(--text-primary);margin-bottom:.5rem}.auth-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary)}.auth-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:500;color:var(--text-primary)}input[_ngcontent-%COMP%]{padding:.75rem 1rem;border:1px solid #ddd;border-radius:var(--border-radius-sm);font-size:1rem;transition:border-color .2s;color:var(--text-primary)}input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary)}input.invalid[_ngcontent-%COMP%]{border-color:#dc3545}.error-hint[_ngcontent-%COMP%]{font-size:.8rem;color:#dc3545}.error-message[_ngcontent-%COMP%]{padding:1rem;background-color:#fff5f5;border:1px solid #fed7d7;border-radius:var(--border-radius-sm);color:#dc3545;font-size:.9rem;text-align:center}.submit-button[_ngcontent-%COMP%]{padding:1rem;background-color:var(--primary);color:var(--secondary);border:none;border-radius:var(--border-radius-md);font-weight:600;cursor:pointer;transition:background-color .2s}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary-dark)}.submit-button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed;opacity:.6}.auth-links[_ngcontent-%COMP%]{text-align:center;font-size:.9rem;color:var(--text-secondary)}.auth-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary);text-decoration:none;font-weight:500;transition:color .2s}.auth-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--primary-dark);text-decoration:underline}.social-divider[_ngcontent-%COMP%]{position:relative;text-align:center;margin:1.5rem 0}.social-divider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:0;right:0;height:1px;background-color:#ddd}.social-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background-color:var(--white);padding:0 1rem;color:var(--text-secondary);font-size:.9rem}.social-login[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.social-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.75rem;padding:.75rem 1rem;border:1px solid #ddd;border-radius:var(--border-radius-sm);background-color:var(--white);color:var(--text-primary);font-weight:500;cursor:pointer;transition:all .2s;text-decoration:none}.social-button[_ngcontent-%COMP%]:hover:not(:disabled){box-shadow:0 2px 4px #0000001a;transform:translateY(-1px)}.social-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.google-button[_ngcontent-%COMP%]{border-color:#dadce0}.google-button[_ngcontent-%COMP%]:hover:not(:disabled){border-color:#4285f4;box-shadow:0 2px 4px #4285f41a}.social-icon[_ngcontent-%COMP%]{width:20px;height:20px;flex-shrink:0}@media (max-width: 480px){.auth-container[_ngcontent-%COMP%]{padding:1rem}.auth-card[_ngcontent-%COMP%]{padding:1.5rem}.social-button[_ngcontent-%COMP%]{padding:.875rem 1rem;font-size:.9rem}}.submit-button[_ngcontent-%COMP%]{background-color:var(--primary)!important;color:var(--secondary)!important}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary-dark)!important}input[_ngcontent-%COMP%]:focus{border-color:var(--primary)!important}.auth-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary)!important}.auth-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:var(--primary-dark)!important}']})};export{D as LoginComponent};
