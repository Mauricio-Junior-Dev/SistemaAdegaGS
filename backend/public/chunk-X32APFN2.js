import{a as re}from"./chunk-XNU6JK3A.js";import{a as Y,b as ee}from"./chunk-UZCBXNKU.js";import{a as ie,b as oe,e as ae,f as ne,g as me,h as le}from"./chunk-ESHAXR7Y.js";import{b as te}from"./chunk-JA72YPWQ.js";import{a as U,b as Z,e as J,h as K,i as Q,m as W,n as X}from"./chunk-A7QNIJLU.js";import"./chunk-J3TQETGC.js";import{g as H}from"./chunk-RQVK44YC.js";import{b as T,c as P}from"./chunk-CDWAOTFZ.js";import"./chunk-OELRWU3S.js";import"./chunk-HCRJH4BX.js";import{a as V,b as $}from"./chunk-OZHJ4RLB.js";import{Y as A,_ as D}from"./chunk-E25F7JMY.js";import{A as G,b as k,d as s,g as B,h as q,k as O,m as R,p as L,x as z,y as j}from"./chunk-O2P35CN4.js";import{$a as u,Bb as r,Cb as e,Db as d,Ic as N,Kb as g,Rc as I,Wa as m,Wb as o,Zc as w,a as x,b as S,cd as y,gb as M,lb as p,sb as l}from"./chunk-G6OUGGHL.js";function se(t,n){t&1&&(r(0,"mat-error"),o(1,"Nome \xE9 obrigat\xF3rio"),e())}function pe(t,n){t&1&&(r(0,"mat-icon",4),o(1,"search"),e())}function ce(t,n){t&1&&d(0,"mat-spinner",22)}function ue(t,n){t&1&&(r(0,"mat-error"),o(1,"CEP \xE9 obrigat\xF3rio"),e())}function fe(t,n){t&1&&(r(0,"mat-error"),o(1,"CEP inv\xE1lido"),e())}function ge(t,n){t&1&&(r(0,"mat-error"),o(1,"Rua \xE9 obrigat\xF3ria"),e())}function he(t,n){t&1&&(r(0,"mat-error"),o(1,"N\xFAmero \xE9 obrigat\xF3rio"),e())}function _e(t,n){t&1&&(r(0,"mat-error"),o(1,"Bairro \xE9 obrigat\xF3rio"),e())}function Ee(t,n){t&1&&(r(0,"mat-error"),o(1,"Cidade \xE9 obrigat\xF3ria"),e())}function Ce(t,n){t&1&&(r(0,"mat-error"),o(1,"Estado \xE9 obrigat\xF3rio"),e())}function ve(t,n){t&1&&(r(0,"mat-error"),o(1,"Use apenas 2 letras"),e())}function be(t,n){t&1&&d(0,"mat-spinner",23)}function Fe(t,n){t&1&&(r(0,"span"),o(1,"Salvar"),e())}function xe(t,n){t&1&&(r(0,"span"),o(1,"Salvando..."),e())}var de=class t{constructor(n,a,i,c,f,h){this.dialogRef=n;this.data=a;this.fb=i;this.http=c;this.cepService=f;this.snackBar=h;this.addressForm=this.fb.group({name:["Casa",[s.required]],street:["",[s.required]],number:["",[s.required]],complement:[""],neighborhood:["",[s.required]],city:["",[s.required]],state:["",[s.required,s.maxLength(2)]],zipcode:["",[s.required,s.pattern(/^\d{5}-?\d{3}$/)]],notes:[""]})}addressForm;loading=!1;cepLoading=!1;cepError=null;onSubmit(){if(this.addressForm.invalid){this.snackBar.open("Por favor, preencha todos os campos obrigat\xF3rios","Fechar",{duration:3e3});return}this.loading=!0;let n={name:this.addressForm.value.name,street:this.addressForm.value.street,number:this.addressForm.value.number,complement:this.addressForm.value.complement||void 0,neighborhood:this.addressForm.value.neighborhood,city:this.addressForm.value.city,state:this.addressForm.value.state,zipcode:this.addressForm.value.zipcode,notes:this.addressForm.value.notes||void 0};this.http.post(`${y.apiUrl}/addresses`,S(x({},n),{user_id:this.data.customerId}),{headers:{"Content-Type":"application/json"}}).subscribe({next:a=>{this.loading=!1,this.snackBar.open("Endere\xE7o cadastrado com sucesso!","Fechar",{duration:3e3}),this.dialogRef.close(a)},error:a=>{this.loading=!1,console.error("Erro ao criar endere\xE7o:",a),this.snackBar.open("Erro ao criar endere\xE7o: "+(a.error?.message||"Erro desconhecido"),"Fechar",{duration:5e3})}})}onCancel(){this.dialogRef.close()}formatZipcode(n){let a=n.target.value,i=this.cepService.formatCep(a);i!==a&&this.addressForm.get("zipcode")?.setValue(i,{emitEvent:!1})}searchCep(){let n=this.addressForm.get("zipcode")?.value;if(!n||!this.cepService.isValidCep(n)){this.snackBar.open("CEP inv\xE1lido. Digite um CEP v\xE1lido.","Fechar",{duration:3e3});return}this.cepLoading=!0,this.cepError=null,this.cepService.searchCep(n).subscribe({next:a=>{this.addressForm.patchValue({street:a.street,neighborhood:a.neighborhood,city:a.city,state:a.state}),this.cepLoading=!1,this.snackBar.open(`Endere\xE7o encontrado: ${a.street}, ${a.neighborhood} - ${a.city}/${a.state}`,"Fechar",{duration:3e3})},error:a=>{console.error("Erro ao buscar CEP:",a),this.cepError=a.message||"Erro ao buscar CEP",this.cepLoading=!1,this.snackBar.open("Erro ao buscar CEP: "+this.cepError,"Fechar",{duration:3e3})}})}clearCepError(){this.cepError=null}static \u0275fac=function(a){return new(a||t)(u(ie),u(oe),u(j),u(w),u(re),u(T))};static \u0275cmp=M({type:t,selectors:[["app-new-address-dialog"]],decls:64,vars:17,consts:[["mat-dialog-title",""],[1,"address-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Ex: Casa, Trabalho"],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","zipcode","placeholder","00000-000","maxlength","9",3,"input","blur"],["matSuffix","",4,"ngIf"],["matSuffix","","diameter","20",4,"ngIf"],["matInput","","formControlName","street","placeholder","Nome da rua"],[1,"form-row"],["appearance","outline",1,"half-width"],["matInput","","formControlName","number","placeholder","123"],["matInput","","formControlName","complement","placeholder","Apto, Bloco, etc."],["matInput","","formControlName","neighborhood","placeholder","Nome do bairro"],["matInput","","formControlName","city","placeholder","Nome da cidade"],["matInput","","formControlName","state","placeholder","SP","maxlength","2",2,"text-transform","uppercase"],["matInput","","formControlName","notes","placeholder","Instru\xE7\xF5es especiais para entrega","rows","2"],["align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20","style","display: inline-block; margin-right: 8px;",4,"ngIf"],["matSuffix","","diameter","20"],["diameter","20",2,"display","inline-block","margin-right","8px"]],template:function(a,i){if(a&1&&(r(0,"h2",0),o(1,"Novo Endere\xE7o"),e(),r(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),o(6,"Nome do Endere\xE7o"),e(),d(7,"input",3),r(8,"mat-icon",4),o(9,"home"),e(),p(10,se,2,0,"mat-error",5),e(),r(11,"mat-form-field",2)(12,"mat-label"),o(13,"CEP"),e(),r(14,"input",6),g("input",function(f){return i.formatZipcode(f)})("blur",function(){return i.searchCep()}),e(),p(15,pe,2,0,"mat-icon",7)(16,ce,1,0,"mat-spinner",8)(17,ue,2,0,"mat-error",5)(18,fe,2,0,"mat-error",5),e(),r(19,"mat-form-field",2)(20,"mat-label"),o(21,"Rua"),e(),d(22,"input",9),r(23,"mat-icon",4),o(24,"location_on"),e(),p(25,ge,2,0,"mat-error",5),e(),r(26,"div",10)(27,"mat-form-field",11)(28,"mat-label"),o(29,"N\xFAmero"),e(),d(30,"input",12),p(31,he,2,0,"mat-error",5),e(),r(32,"mat-form-field",11)(33,"mat-label"),o(34,"Complemento"),e(),d(35,"input",13),e()(),r(36,"mat-form-field",2)(37,"mat-label"),o(38,"Bairro"),e(),d(39,"input",14),p(40,_e,2,0,"mat-error",5),e(),r(41,"div",10)(42,"mat-form-field",11)(43,"mat-label"),o(44,"Cidade"),e(),d(45,"input",15),p(46,Ee,2,0,"mat-error",5),e(),r(47,"mat-form-field",11)(48,"mat-label"),o(49,"Estado"),e(),d(50,"input",16),p(51,Ce,2,0,"mat-error",5)(52,ve,2,0,"mat-error",5),e()(),r(53,"mat-form-field",2)(54,"mat-label"),o(55,"Observa\xE7\xF5es (opcional)"),e(),d(56,"textarea",17),e()()(),r(57,"mat-dialog-actions",18)(58,"button",19),g("click",function(){return i.onCancel()}),o(59,"Cancelar"),e(),r(60,"button",20),g("click",function(){return i.onSubmit()}),p(61,be,1,0,"mat-spinner",21)(62,Fe,2,0,"span",5)(63,xe,2,0,"span",5),e()()),a&2){let c,f,h,_,E,C,v,b,F;m(3),l("formGroup",i.addressForm),m(7),l("ngIf",(c=i.addressForm.get("name"))==null?null:c.hasError("required")),m(5),l("ngIf",!i.cepLoading),m(),l("ngIf",i.cepLoading),m(),l("ngIf",(f=i.addressForm.get("zipcode"))==null?null:f.hasError("required")),m(),l("ngIf",(h=i.addressForm.get("zipcode"))==null?null:h.hasError("pattern")),m(7),l("ngIf",(_=i.addressForm.get("street"))==null?null:_.hasError("required")),m(6),l("ngIf",(E=i.addressForm.get("number"))==null?null:E.hasError("required")),m(9),l("ngIf",(C=i.addressForm.get("neighborhood"))==null?null:C.hasError("required")),m(6),l("ngIf",(v=i.addressForm.get("city"))==null?null:v.hasError("required")),m(5),l("ngIf",(b=i.addressForm.get("state"))==null?null:b.hasError("required")),m(),l("ngIf",(F=i.addressForm.get("state"))==null?null:F.hasError("maxlength")),m(6),l("disabled",i.loading),m(2),l("disabled",i.addressForm.invalid||i.loading),m(),l("ngIf",i.loading),m(),l("ngIf",!i.loading),m(),l("ngIf",i.loading)}},dependencies:[I,N,G,O,k,B,q,z,R,L,le,ae,me,ne,D,A,$,V,Q,K,U,Z,J,X,W,H,P,ee,Y,te],styles:[".address-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:16px 0}.full-width[_ngcontent-%COMP%]{width:100%}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px}.half-width[_ngcontent-%COMP%]{flex:1}mat-dialog-actions[_ngcontent-%COMP%]{margin-top:16px;padding:16px 0}mat-dialog-content[_ngcontent-%COMP%]{min-width:400px;max-width:600px}@media (max-width: 600px){.form-row[_ngcontent-%COMP%]{flex-direction:column}.half-width[_ngcontent-%COMP%]{width:100%}mat-dialog-content[_ngcontent-%COMP%]{min-width:auto;max-width:100%}}"]})};export{de as NewAddressDialogComponent};
