import{a as G}from"./chunk-NEKTJC2U.js";import{a as Y}from"./chunk-UV7RJRPZ.js";import{a as N}from"./chunk-VKLNLCGT.js";import{a as R,b as U}from"./chunk-LUD35HDA.js";import{T as Q,_ as q}from"./chunk-H4HZ2WXW.js";import{h as A}from"./chunk-L7YZATBO.js";import"./chunk-JEC3ZXLW.js";import{b as F,g as j,j as B,z as D}from"./chunk-7Q6V27MS.js";import{a as V,h as W}from"./chunk-UIAL7XLZ.js";import{$a as f,$b as S,Bb as a,Cb as r,Db as b,Hb as h,Hc as E,Ic as L,Kb as g,Lb as d,Oc as $,Rc as z,Ua as P,Wa as c,Wb as m,Xb as x,Yb as v,ac as I,bc as k,dd as M,gb as O,hc as y,jc as w,lb as l,qc as T,sb as p,ta as u,ua as _}from"./chunk-QUOLBKI4.js";function J(n,t){if(n&1){let e=h();a(0,"button",11),g("click",function(){u(e);let o=d();return o.searchTerm="",_(o.filterAndGroupProducts())}),a(1,"mat-icon"),m(2,"close"),r()()}}function K(n,t){n&1&&(a(0,"div",12),b(1,"div",13),r())}function X(n,t){if(n&1){let e=h();a(0,"div",14)(1,"p",15),m(2),r(),a(3,"button",16),g("click",function(){u(e);let o=d();return _(o.loadProducts())}),m(4," Tentar Novamente "),r()()}if(n&2){let e=d();c(2),x(e.error)}}function Z(n,t){if(n&1&&(a(0,"p",35),m(1),r()),n&2){let e=d().$implicit;c(),v(" ",e.description," ")}}function tt(n,t){if(n&1){let e=h();a(0,"button",36),g("click",function(){u(e);let o=d().$implicit,s=d(3);return _(s.addComboToCart(o))}),m(1," Adicionar "),r()}}function et(n,t){if(n&1){let e=h();a(0,"div",37)(1,"button",38),g("click",function(){u(e);let o=d().$implicit,s=d(3);return _(s.decrease(s.comboAdapter(o)))}),m(2," - "),r(),a(3,"span",39),m(4),r(),a(5,"button",40),g("click",function(){u(e);let o=d().$implicit,s=d(3);return _(s.addComboToCart(o))}),m(6," + "),r()()}if(n&2){let e=d().$implicit,i=d(3);c(4),x(i.getQuantity(i.comboAdapter(e)))}}function it(n,t){if(n&1&&(a(0,"div",24)(1,"div",25),b(2,"img",26),r(),a(3,"div",27)(4,"h3",28),m(5),r(),l(6,Z,2,1,"p",29),r(),a(7,"div",30)(8,"div",31)(9,"span",32),m(10),y(11,"number"),r(),l(12,tt,2,0,"button",33)(13,et,7,1,"div",34),r()()()),n&2){let e=t.$implicit,i=d(3);c(2),p("src",i.getImageUrl(i.comboAdapter(e)),P)("alt",e.name),c(3),x(e.name),c(),p("ngIf",e.description),c(4),v("R$ ",w(11,7,e.price,"1.2-2"),""),c(2),p("ngIf",i.getQuantity(i.comboAdapter(e))===0),c(),p("ngIf",i.getQuantity(i.comboAdapter(e))>0)}}function nt(n,t){if(n&1&&(a(0,"div",20)(1,"h2",21),m(2,"Combos"),r(),a(3,"div",22),l(4,it,14,10,"div",23),r()()),n&2){let e=d(2);c(4),p("ngForOf",e.combos)}}function ot(n,t){if(n&1&&(a(0,"p",35),m(1),r()),n&2){let e=d().$implicit;c(),v(" ",e.description," ")}}function rt(n,t){if(n&1){let e=h();a(0,"button",42),g("click",function(){u(e);let o=d().$implicit,s=d(3);return _(s.increase(o))}),m(1),r()}if(n&2){let e=d().$implicit;p("disabled",e.current_stock<=0),c(),v(" ",e.current_stock>0?"Adicionar":"Esgotado"," ")}}function at(n,t){if(n&1){let e=h();a(0,"div",37)(1,"button",38),g("click",function(){u(e);let o=d().$implicit,s=d(3);return _(s.decrease(o))}),m(2," - "),r(),a(3,"span",39),m(4),r(),a(5,"button",43),g("click",function(){u(e);let o=d().$implicit,s=d(3);return _(s.increase(o))}),m(6," + "),r()()}if(n&2){let e=d().$implicit,i=d(3);c(4),x(i.getQuantity(e)),c(),p("disabled",i.getQuantity(e)>=e.current_stock)}}function ct(n,t){if(n&1&&(a(0,"div",24)(1,"div",25),b(2,"img",26),r(),a(3,"div",27)(4,"h3",28),m(5),r(),l(6,ot,2,1,"p",29),r(),a(7,"div",30)(8,"div",31)(9,"span",32),m(10),y(11,"number"),r(),l(12,rt,2,2,"button",41)(13,at,7,2,"div",34),r()()()),n&2){let e=t.$implicit,i=d(3);c(2),p("src",i.getImageUrl(e),P)("alt",e.name),c(3),x(e.name),c(),p("ngIf",e.description),c(4),v("R$ ",w(11,7,e.price,"1.2-2"),""),c(2),p("ngIf",i.getQuantity(e)===0),c(),p("ngIf",i.getQuantity(e)>0)}}function st(n,t){if(n&1&&(a(0,"div",20)(1,"h2",21),m(2),r(),a(3,"div",22),l(4,ct,14,10,"div",23),r()()),n&2){let e=t.$implicit;c(2),x(e.category.name),c(2),p("ngForOf",e.products)}}function dt(n,t){if(n&1&&(a(0,"div",17),l(1,nt,5,1,"div",18)(2,st,5,2,"div",19),r()),n&2){let e=d();c(),p("ngIf",e.combos.length>0&&(!e.searchTerm||e.searchTerm.trim()==="")),c(),p("ngForOf",e.productsByCategory)}}function mt(n,t){n&1&&(a(0,"div",44)(1,"mat-icon",45),m(2,"restaurant_menu"),r(),a(3,"h2"),m(4,"Nenhum produto encontrado"),r(),a(5,"p"),m(6,"Tente ajustar os filtros ou realizar uma nova busca"),r()())}var H=class n{constructor(t,e,i,o,s,C){this.productService=t;this.comboService=e;this.cartService=i;this.route=o;this.cdr=s;this.toastr=C}products=[];filteredProducts=[];categories=[];combos=[];loading=!0;loadingCombos=!0;selectedCategory=null;searchTerm="";error=null;productsByCategory=[];cartSubscription;cartItemsCache=[];getCategoryImageUrl(t){if(!t.image_url)return"assets/images/no-image.jpg";if(t.image_url.startsWith("http://")||t.image_url.startsWith("https://"))return t.image_url;let e=M.apiUrl.replace(/\/api$/,""),i=t.image_url.startsWith("/")?t.image_url:`/${t.image_url}`,o=t.updated_at?`?v=${t.updated_at}`:"";return`${e}${i}${o}`}ngOnInit(){this.loadCategories(),this.loadCombos(),this.cartSubscription=this.cartService.cartItems$.subscribe(t=>{this.cartItemsCache=t,this.cdr.detectChanges()}),this.route.queryParams.subscribe(t=>{this.selectedCategory=t.categoria?+t.categoria:null,this.searchTerm=t.busca||"",this.loadProducts()})}ngOnDestroy(){this.cartSubscription&&this.cartSubscription.unsubscribe()}loadCategories(){this.productService.getCategories().subscribe({next:t=>{this.categories=t.filter(e=>e.name.toLowerCase()!=="combos"&&e.slug.toLowerCase()!=="combos")},error:t=>{console.error("Error loading categories:",t)}})}loadCombos(){this.loadingCombos=!0,this.comboService.getCombos({per_page:20}).subscribe({next:t=>{this.combos=t.data||[],this.loadingCombos=!1},error:t=>{console.error("Error loading combos:",t),this.loadingCombos=!1}})}comboAdapter(t){return{id:t.id,category_id:0,name:t.name,slug:t.slug||"",description:t.description,price:t.price,original_price:t.original_price,cost_price:t.price,current_stock:999,min_stock:0,doses_por_garrafa:0,doses_vendidas:0,can_sell_by_dose:!1,barcode:t.barcode,is_active:t.is_active,featured:t.featured,offers:t.offers,popular:t.popular,images:t.images,image_url:t.images?.[0]||void 0}}loadProducts(){let t={};this.selectedCategory&&(t.category_id=this.selectedCategory),this.loading=!0,this.error=null,this.productService.getProducts(t).subscribe({next:e=>{this.products=e.data||[],this.filterAndGroupProducts(),this.loading=!1},error:e=>{console.error("Error loading products:",e),this.error="Erro ao carregar produtos. Por favor, tente novamente.",this.loading=!1}})}filterAndGroupProducts(){let t=this.products;if(this.searchTerm.trim()){let i=this.searchTerm.toLowerCase().trim();t=this.products.filter(o=>o.name.toLowerCase().includes(i)||o.description&&o.description.toLowerCase().includes(i))}this.filteredProducts=t;let e=new Map;t.forEach(i=>{let o=i.category_id,s=this.categories.find(C=>C.id===o);s&&(e.has(o)||e.set(o,{category:s,products:[]}),e.get(o).products.push(i))}),this.productsByCategory=Array.from(e.values()).sort((i,o)=>i.category.name.localeCompare(o.category.name))}onCategoryChange(t){this.selectedCategory=t,this.loadProducts()}onSearchInput(t){let e=t.target;this.searchTerm=e.value,this.filterAndGroupProducts()}addToCart(t){let e=this.getQuantity(t);if(this.cartService.addItem(t),e===0){let i=t.name,s=i.toLowerCase().endsWith("a")||i.toLowerCase().endsWith("\xE3o")||i.toLowerCase().endsWith("ade")?`${i} adicionada!`:`${i} adicionado!`;this.toastr.success(s,"",{timeOut:1500,positionClass:"toast-bottom-center",progressBar:!1})}}getQuantity(t){let e=this.cartItemsCache.find(i=>i.id===t.id);return e?e.quantity:0}increase(t){let e=this.getQuantity(t);if(!(e>=t.current_stock)){if(this.cartService.addItem(t),e===0){let i=t.name,s=i.toLowerCase().endsWith("a")||i.toLowerCase().endsWith("\xE3o")||i.toLowerCase().endsWith("ade")?`${i} adicionada!`:`${i} adicionado!`;this.toastr.success(s,"",{timeOut:1500,positionClass:"toast-bottom-center",progressBar:!1})}this.cdr.detectChanges()}}decrease(t){let e=this.getQuantity(t);e>1?this.cartService.updateQuantity(t.id,e-1):this.cartService.removeItem(t.id),this.cdr.detectChanges()}increaseQuantity(t){this.increase(t)}decreaseQuantity(t){this.decrease(t)}getImageUrl(t){let e=t.image_url;if(e){if(e.startsWith("http://")||e.startsWith("https://"))return`${e}?v=${encodeURIComponent(t.updated_at)}`;if(e.startsWith("/storage/")||e.startsWith("storage/")){let o=M.apiUrl.replace(/\/api$/,""),s=e.startsWith("/")?e:`/${e}`;return`${o}${s}?v=${encodeURIComponent(t.updated_at)}`}return`${e}?v=${encodeURIComponent(t.updated_at)}`}let i=t.images?.[0];return i||"assets/images/no-image.jpg"}hasOffer(t){let e=t.original_price;return e&&e>t.price}getOriginalPrice(t){return t.original_price||t.price}getDiscountPercentage(t){let e=t.original_price;return!e||e<=t.price?0:Math.round((e-t.price)/e*100)}addComboToCart(t){let e=this.comboAdapter(t),i=this.getQuantity(e);if(this.cartService.addComboToCart(t,1),i===0){let o=t.name,C=o.toLowerCase().endsWith("a")||o.toLowerCase().endsWith("\xE3o")||o.toLowerCase().endsWith("ade")?`${o} adicionado!`:`${o} adicionado!`;this.toastr.success(C,"",{timeOut:1500,positionClass:"toast-bottom-center",progressBar:!1})}this.cdr.detectChanges()}static \u0275fac=function(e){return new(e||n)(f(G),f(Y),f(N),f(V),f(T),f(A))};static \u0275cmp=O({type:n,selectors:[["app-product-list-page"]],decls:13,vars:6,consts:[[1,"products-page"],[1,"search-bar-sticky"],[1,"container"],[1,"search-wrapper"],[1,"search-icon"],["type","text","placeholder","Buscar produtos...",1,"search-input",3,"ngModelChange","input","ngModel"],["class","clear-search","mat-icon-button","",3,"click",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","error-container",4,"ngIf"],["class","menu-list",4,"ngIf"],["class","empty-state",4,"ngIf"],["mat-icon-button","",1,"clear-search",3,"click"],[1,"loading-container"],[1,"loading-spinner"],[1,"error-container"],[1,"error-message"],[1,"retry-button",3,"click"],[1,"menu-list"],["class","category-group",4,"ngIf"],["class","category-group",4,"ngFor","ngForOf"],[1,"category-group"],[1,"category-separator"],[1,"menu-items"],["class","menu-item",4,"ngFor","ngForOf"],[1,"menu-item"],[1,"menu-item-image"],[3,"src","alt"],[1,"menu-item-info"],[1,"menu-item-name"],["class","menu-item-description",4,"ngIf"],[1,"menu-item-action"],[1,"item-actions"],[1,"price"],["class","btn-add",3,"click",4,"ngIf"],["class","qty-controls",4,"ngIf"],[1,"menu-item-description"],[1,"btn-add",3,"click"],[1,"qty-controls"],[1,"qty-btn","minus",3,"click"],[1,"qty-value"],[1,"qty-btn","plus",3,"click"],["class","btn-add",3,"disabled","click",4,"ngIf"],[1,"btn-add",3,"click","disabled"],[1,"qty-btn","plus",3,"click","disabled"],[1,"empty-state"],[1,"empty-icon"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"mat-icon",4),m(5,"search"),r(),a(6,"input",5),k("ngModelChange",function(s){return I(i.searchTerm,s)||(i.searchTerm=s),s}),g("input",function(s){return i.onSearchInput(s)}),r(),l(7,J,3,0,"button",6),r()()(),a(8,"div",2),l(9,K,2,0,"div",7)(10,X,5,1,"div",8)(11,dt,3,2,"div",9)(12,mt,7,0,"div",10),r()()),e&2&&(c(6),S("ngModel",i.searchTerm),c(),p("ngIf",i.searchTerm),c(2),p("ngIf",i.loading),c(),p("ngIf",i.error),c(),p("ngIf",!i.loading&&!i.error),c(),p("ngIf",!i.loading&&!i.error&&i.productsByCategory.length===0))},dependencies:[z,E,L,$,W,D,F,j,B,U,R,q,Q],styles:[".products-page[_ngcontent-%COMP%]{min-height:100vh;background-color:var(--background);padding-top:64px}.container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}.search-bar-sticky[_ngcontent-%COMP%]{position:sticky;top:64px;z-index:998;background-color:#fff;box-shadow:0 2px 8px #0000001a;padding:1rem 0;margin-bottom:1rem}.search-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;background-color:#f5f5f5;border-radius:24px;padding:.75rem 1rem;position:relative}.search-icon[_ngcontent-%COMP%]{color:#666;font-size:24px;width:24px;height:24px}.search-input[_ngcontent-%COMP%]{flex:1;border:none;background:none;outline:none;font-size:1rem;color:#1a1a1a}.search-input[_ngcontent-%COMP%]::placeholder{color:#999}.clear-search[_ngcontent-%COMP%]{color:#666;width:32px;height:32px}.clear-search[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.menu-list[_ngcontent-%COMP%]{padding-bottom:2rem}.category-group[_ngcontent-%COMP%]{margin-bottom:2.5rem}.category-separator[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#1a1a1a;margin:0 0 1.5rem;padding-bottom:.75rem;border-bottom:2px solid var(--primary);position:sticky;top:100px;background-color:#f8f9fa;z-index:10;padding-top:.5rem;margin-top:0}.menu-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:0}.menu-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:#fff;border-bottom:1px solid #e0e0e0;transition:background-color .2s;min-height:100px}.menu-item[_ngcontent-%COMP%]:hover{background-color:#fafafa}.menu-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.menu-item-image[_ngcontent-%COMP%]{flex-shrink:0;width:80px;height:80px;border-radius:8px;overflow:hidden;background-color:#f5f5f5;display:flex;align-items:center;justify-content:center}.menu-item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.menu-item-info[_ngcontent-%COMP%]{flex:1;min-width:0;display:flex;flex-direction:column;gap:.25rem}.menu-item-name[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:#1a1a1a;margin:0;line-height:1.3}.menu-item-description[_ngcontent-%COMP%]{font-size:.875rem;color:#666;margin:0;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.menu-item-action[_ngcontent-%COMP%]{flex-shrink:0;min-width:130px}.item-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:10px;min-width:100px}.price[_ngcontent-%COMP%]{font-weight:700;color:var(--primary);font-size:1rem;margin-bottom:4px}.btn-add[_ngcontent-%COMP%]{background-color:var(--primary);color:#000;border:none;padding:10px 20px;border-radius:24px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap;min-height:40px;box-shadow:0 2px 6px #00000026;display:flex;align-items:center;justify-content:center}.btn-add[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary-dark);box-shadow:0 3px 8px #0003;transform:translateY(-1px)}.btn-add[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0);box-shadow:0 1px 3px #00000026}.btn-add[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed;color:#666;box-shadow:none}.qty-controls[_ngcontent-%COMP%]{display:flex;align-items:center;background:#f5f5f5;border-radius:24px;padding:4px;gap:4px}.qty-btn[_ngcontent-%COMP%]{width:40px;height:40px;border:none;background:#fff;border-radius:50%;font-weight:700;color:var(--primary);box-shadow:0 2px 4px #00000026;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.25rem;transition:all .2s;min-width:40px;min-height:40px}.qty-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#000;transform:scale(1.05);box-shadow:0 3px 6px #0003}.qty-btn[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.95)}.qty-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.qty-value[_ngcontent-%COMP%]{margin:0 12px;font-weight:600;font-size:1rem;min-width:24px;text-align:center;color:var(--text-primary)}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:3rem}.loading-spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid var(--primary);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{text-align:center;padding:3rem;background-color:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.error-message[_ngcontent-%COMP%]{color:#d32f2f;margin-bottom:1rem}.retry-button[_ngcontent-%COMP%]{padding:.5rem 1.5rem;background-color:var(--primary);color:#000;border:none;border-radius:20px;cursor:pointer;font-weight:600}.retry-button[_ngcontent-%COMP%]:hover{background-color:var(--primary-dark)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;background-color:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.empty-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:#ccc;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#1a1a1a;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666}@media (max-width: 767px){.menu-item-image[_ngcontent-%COMP%]{width:70px;height:70px}.menu-item-name[_ngcontent-%COMP%]{font-size:1rem}.menu-item-description[_ngcontent-%COMP%]{font-size:.8rem}.price[_ngcontent-%COMP%]{font-size:.9rem}.menu-item-action[_ngcontent-%COMP%]{min-width:100px}.item-actions[_ngcontent-%COMP%]{min-width:70px}.menu-item[_ngcontent-%COMP%]{min-height:110px;padding:.875rem}.btn-add[_ngcontent-%COMP%]{padding:10px 18px;font-size:.95rem;min-height:44px}.qty-btn[_ngcontent-%COMP%]{width:36px;height:36px;font-size:1.1rem;min-width:36px;min-height:36px}.qty-value[_ngcontent-%COMP%]{margin:0 10px;font-size:.95rem}.item-actions[_ngcontent-%COMP%]{min-width:90px}.category-separator[_ngcontent-%COMP%]{top:100px;font-size:1.25rem}}@media (min-width: 768px){.menu-items[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:0}.menu-item[_ngcontent-%COMP%]{border-right:1px solid #e0e0e0}.menu-item[_ngcontent-%COMP%]:nth-child(2n){border-right:none}.category-group[_ngcontent-%COMP%]:last-child   .menu-item[_ngcontent-%COMP%]:last-child, .category-group[_ngcontent-%COMP%]:last-child   .menu-item[_ngcontent-%COMP%]:nth-last-child(2){border-bottom:none}.menu-item-image[_ngcontent-%COMP%]{width:100px;height:100px}.menu-item-name[_ngcontent-%COMP%]{font-size:1.2rem}}"]})};export{H as ProductListPageComponent};
