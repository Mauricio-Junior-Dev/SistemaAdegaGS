import{Zc as l,a,dd as i,ga as n,la as c}from"./chunk-QUOLBKI4.js";var s=class r{constructor(o){this.http=o}apiUrl=i.apiUrl;initializeGoogle(){return new Promise((o,e)=>{typeof window<"u"&&window.google?(this.setupGoogleAuth(),o()):this.loadGoogleScript().then(()=>{this.setupGoogleAuth(),o()}).catch(e)})}setupGoogleAuth(){window.google.accounts.id.initialize({client_id:i.googleClientId,callback:o=>{this.handleGoogleResponse(o)},auto_select:!1,cancel_on_tap_outside:!0,use_fedcm_for_prompt:!1})}loadGoogleScript(){return new Promise((o,e)=>{if(document.querySelector('script[src*="accounts.google.com/gsi/client"]')){o();return}let t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>o(),t.onerror=()=>e(new Error("Falha ao carregar script do Google")),document.head.appendChild(t)})}loginWithGoogle(){if(window.google&&window.google.accounts)try{window.google.accounts.id.prompt()}catch(o){console.error("Erro ao enviar prompt do Google:",o)}else console.error("Google SDK n\xE3o carregado")}handleGoogleResponse(o){try{let e=JSON.parse(atob(o.credential.split(".")[1]));this.sendSocialAuthToBackend("google",{token:o.credential,email:e.email,name:e.name,picture:e.picture}).subscribe({next:t=>{window.dispatchEvent(new CustomEvent("social-auth-success",{detail:t}))},error:t=>{console.error("Erro na autentica\xE7\xE3o social:",t),window.dispatchEvent(new CustomEvent("social-auth-error",{detail:t}))}})}catch(e){console.error("Erro ao processar token do Google:",e),window.dispatchEvent(new CustomEvent("social-auth-error",{detail:{message:"Erro ao processar token do Google"}}))}}sendSocialAuthToBackend(o,e){return this.http.post(`${this.apiUrl}/auth/social`,a({provider:o},e))}static \u0275fac=function(e){return new(e||r)(c(l))};static \u0275prov=n({token:r,factory:r.\u0275fac,providedIn:"root"})};export{s as a};
