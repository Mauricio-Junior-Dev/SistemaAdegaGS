import{a as Ce,b as wt}from"./chunk-YM5XMKI3.js";import{a as he,b as kt,c as Ft}from"./chunk-6JEG3PPG.js";import{a as A}from"./chunk-LRKXLGQ4.js";import{a as St,b as yt}from"./chunk-QMFDKZL2.js";import{a as Pt,b as bt}from"./chunk-7P4XSV4R.js";import"./chunk-EYVEXPNH.js";import{a as de,b as pe}from"./chunk-ROER2RFV.js";import{a as ue,b as Et,c as Mt,e as ge,f as fe,g as _e,h as $}from"./chunk-NJG33T2I.js";import{a as ht,b as Ct,c as vt,d as xt}from"./chunk-W6W5QBSK.js";import"./chunk-F5X5MWHG.js";import{a as Xe,c as Ke,d as Je,e as Ye}from"./chunk-DPGLS2YX.js";import{a as se,b as _t}from"./chunk-NXB367PQ.js";import{a as Z,b as it,c as ot,d as rt,e as nt,f as at,g as lt,h as ct,i as mt,j as st,k as dt}from"./chunk-HB4FNUQQ.js";import"./chunk-MS4AQ6UA.js";import{d as ne,h as ae,i as le}from"./chunk-U7CDANII.js";import{a as ee,b as pt,c as ut,d as gt,e as ft,h as te,i as ie,m as oe,n as re}from"./chunk-RHC5ILWF.js";import"./chunk-XTFDZCPR.js";import{a as Ze,c as et,g as tt}from"./chunk-ZHIFTSGJ.js";import"./chunk-HTFI32IU.js";import"./chunk-C4KZ6I4Q.js";import{a as ce,b as me}from"./chunk-EQKA6Y5K.js";import{b as B,c as R}from"./chunk-OBC24UR6.js";import"./chunk-CEPC3JHI.js";import"./chunk-FIIM6QS2.js";import{a as q,b as N}from"./chunk-6R7SEWBP.js";import{T as X,Y as T,_ as V}from"./chunk-UVGQBODX.js";import{A as Y,b as K,d as g,g as J,h as $e,j as Ae,k as je,l as Le,m as ze,p as He,u as We,v as Qe,y as Ue,z as Ge}from"./chunk-M22BVTMS.js";import{$a as x,$b as Ee,Bb as r,Cb as i,Db as C,Eb as E,Fb as M,Hb as y,Hc as U,Ic as D,Kb as u,Lb as h,M as Te,Oc as Ne,Qb as H,R as Ve,Rb as W,Rc as O,Sb as Q,Ua as L,Vb as I,Wa as c,Wb as a,Xb as S,Yb as b,a as Pe,ac as Me,b as Oe,ba as k,bc as Se,cd as G,ec as Re,gb as w,hc as ye,jc as ke,l as be,lb as d,qc as qe,sb as s,ta as f,tb as Be,ua as _,ub as z}from"./chunk-AFGHNMPW.js";function Qt(n,e){if(n&1&&C(0,"img",44),n&2){let t=h();s("src",t.resolvePreview(t.imagePreview),L)}}function Ut(n,e){n&1&&(r(0,"mat-icon"),a(1,"add_photo_alternate"),i())}function Gt(n,e){if(n&1){let t=y();r(0,"button",45),u("click",function(){f(t);let l=h();return _(l.removeImage())}),r(1,"mat-icon"),a(2,"delete"),i()()}}function Xt(n,e){n&1&&(r(0,"mat-error"),a(1," Nome \xE9 obrigat\xF3rio "),i())}function Kt(n,e){if(n&1&&(r(0,"mat-option",46),a(1),i()),n&2){let t=e.$implicit;s("value",t.id),c(),b(" ",t.name," ")}}function Jt(n,e){n&1&&(r(0,"mat-error"),a(1," Categoria \xE9 obrigat\xF3ria "),i())}function Yt(n,e){if(n&1&&(r(0,"mat-option",46),a(1),i()),n&2){let t=e.$implicit;s("value",t.id),c(),b(" ",t.name," ")}}function Zt(n,e){n&1&&(r(0,"mat-error"),a(1," Produto pai \xE9 obrigat\xF3rio para Caixa/Fardo "),i())}function ei(n,e){n&1&&(r(0,"mat-error"),a(1," Quantidade por Caixa/Fardo \xE9 obrigat\xF3ria "),i())}function ti(n,e){n&1&&(r(0,"mat-error"),a(1," Quantidade por Caixa/Fardo deve ser maior que 1 "),i())}function ii(n,e){if(n&1&&(r(0,"div",47)(1,"div",11)(2,"mat-form-field",12)(3,"mat-label"),a(4,"Produto Pai (Unidade Base)"),i(),r(5,"mat-select",48)(6,"mat-option",46),a(7,"Selecione o produto base"),i(),d(8,Yt,2,2,"mat-option",15),i(),d(9,Zt,2,0,"mat-error",7),i(),r(10,"mat-form-field",12)(11,"mat-label"),a(12,"Quantidade por Caixa/Fardo"),i(),C(13,"input",49),r(14,"mat-hint"),a(15,"Quantas unidades do produto pai equivalem a 1 Caixa/Fardo"),i(),d(16,ei,2,0,"mat-error",7)(17,ti,2,0,"mat-error",7),i()()()),n&2){let t,o,l,m,p=h();c(6),s("value",null),c(2),s("ngForOf",p.availableParentProducts),c(),s("ngIf",(t=p.productForm.get("parent_product_id"))==null?null:t.hasError("required")),c(4),s("disabled",!((o=p.productForm.get("is_pack"))!=null&&o.value)),c(3),s("ngIf",(l=p.productForm.get("stock_multiplier"))==null?null:l.hasError("required")),c(),s("ngIf",(m=p.productForm.get("stock_multiplier"))==null?null:m.hasError("min"))}}function oi(n,e){n&1&&(r(0,"mat-error"),a(1," C\xF3digo de barras j\xE1 existe "),i())}function ri(n,e){n&1&&(r(0,"mat-error"),a(1," Pre\xE7o \xE9 obrigat\xF3rio "),i())}function ni(n,e){n&1&&(r(0,"mat-error"),a(1," Pre\xE7o deve ser maior que zero "),i())}function ai(n,e){n&1&&(r(0,"mat-error"),a(1," Pre\xE7o original deve ser maior que zero "),i())}function li(n,e){n&1&&(r(0,"mat-error"),a(1," O pre\xE7o original deve ser maior que o pre\xE7o de venda "),i())}function ci(n,e){if(n&1&&(r(0,"div",53)(1,"mat-icon"),a(2,"check_circle"),i(),r(3,"span")(4,"strong"),a(5),i(),a(6," O cliente ver\xE1: de "),r(7,"del"),a(8),ye(9,"number"),i(),a(10),ye(11,"number"),i()()),n&2){let t=h(2);c(5),b("Desconto de ",t.discountInfo.percentage,"% aplicado!"),c(3),b("R$ ",ke(9,3,t.discountInfo.originalPrice,"1.2-2"),""),c(2),b(" por R$ ",ke(11,6,t.discountInfo.finalPrice,"1.2-2")," ")}}function mi(n,e){n&1&&(r(0,"div",54)(1,"mat-icon"),a(2,"error"),i(),r(3,"span")(4,"strong"),a(5,"Erro:"),i(),a(6," O pre\xE7o original deve ser maior que o pre\xE7o de venda "),i()())}function si(n,e){if(n&1&&(r(0,"div",50),d(1,ci,12,9,"div",51)(2,mi,7,0,"div",52),i()),n&2){let t=h();c(),s("ngIf",t.discountInfo.isValid),c(),s("ngIf",!t.discountInfo.isValid)}}function di(n,e){n&1&&(r(0,"mat-error"),a(1," Quantidade \xE9 obrigat\xF3ria "),i())}function pi(n,e){n&1&&(r(0,"mat-error"),a(1," Quantidade n\xE3o pode ser negativa "),i())}function ui(n,e){if(n&1&&(r(0,"mat-form-field",12)(1,"mat-label"),a(2,"Quantidade em Estoque"),i(),C(3,"input",55),d(4,di,2,0,"mat-error",7)(5,pi,2,0,"mat-error",7),i()),n&2){let t,o,l=h();c(4),s("ngIf",(t=l.productForm.get("current_stock"))==null?null:t.hasError("required")),c(),s("ngIf",(o=l.productForm.get("current_stock"))==null?null:o.hasError("min"))}}function gi(n,e){n&1&&(r(0,"mat-error"),a(1," Estoque m\xEDnimo \xE9 obrigat\xF3rio "),i())}function fi(n,e){n&1&&(r(0,"mat-error"),a(1," Estoque m\xEDnimo n\xE3o pode ser negativo "),i())}function _i(n,e){if(n&1&&(r(0,"mat-form-field",12)(1,"mat-label"),a(2,"Estoque M\xEDnimo"),i(),C(3,"input",56),d(4,gi,2,0,"mat-error",7)(5,fi,2,0,"mat-error",7),i()),n&2){let t,o,l=h();c(4),s("ngIf",(t=l.productForm.get("min_stock"))==null?null:t.hasError("required")),c(),s("ngIf",(o=l.productForm.get("min_stock"))==null?null:o.hasError("min"))}}function hi(n,e){n&1&&(r(0,"mat-error"),a(1," Doses por garrafa \xE9 obrigat\xF3rio "),i())}function Ci(n,e){n&1&&(r(0,"mat-error"),a(1," Deve ser pelo menos 1 dose por garrafa "),i())}function vi(n,e){n&1&&(r(0,"mat-error"),a(1," Pre\xE7o da dose deve ser maior que zero "),i())}function xi(n,e){if(n&1&&(r(0,"div",57)(1,"h3"),a(2,"Configura\xE7\xF5es de Venda por Dose"),i(),r(3,"div",11)(4,"mat-form-field",12)(5,"mat-label"),a(6,"Doses por Garrafa"),i(),C(7,"input",58),d(8,hi,2,0,"mat-error",7)(9,Ci,2,0,"mat-error",7),i(),r(10,"mat-form-field",12)(11,"mat-label"),a(12,"Pre\xE7o da Dose"),i(),C(13,"input",59),r(14,"span",24),a(15,"R$\xA0"),i(),d(16,vi,2,0,"mat-error",7),i()(),r(17,"mat-slide-toggle",60),a(18," Permitir venda por dose "),i()()),n&2){let t,o,l,m=h();c(8),s("ngIf",(t=m.productForm.get("doses_por_garrafa"))==null?null:t.hasError("required")),c(),s("ngIf",(o=m.productForm.get("doses_por_garrafa"))==null?null:o.hasError("min")),c(7),s("ngIf",(l=m.productForm.get("dose_price"))==null?null:l.hasError("min"))}}function Pi(n,e){n&1&&(r(0,"mat-icon"),C(1,"mat-spinner",61),i())}function bi(n,e){if(n&1&&(r(0,"span"),a(1),i()),n&2){let t=h();c(),S(t.isEdit?"Salvar":"Criar")}}var ve=class n{constructor(e,t,o,l,m,p){this.fb=e;this.productService=t;this.categoryService=o;this.snackBar=l;this.dialogRef=m;this.data=p;if(this.isEdit=!!p.product,this.productForm=this.fb.group({name:["",g.required],description:[""],category_id:["",g.required],barcode:[""],price:["",[g.required,g.min(0)]],original_price:["",[g.min(0)]],current_stock:["",[g.required,g.min(0)]],min_stock:["",[g.required,g.min(0)]],doses_por_garrafa:[5,[g.required,g.min(1)]],can_sell_by_dose:[!1],dose_price:["",[g.min(0)]],is_pack:[!1],parent_product_id:[null],stock_multiplier:[1],is_active:[!0],visible_online:[!0],featured:[!1],offers:[!1],popular:[!1]}),this.isEdit&&p.product){let P=!!(p.product.parent_product_id&&p.product.stock_multiplier&&p.product.stock_multiplier>1);if(this.productForm.patchValue(Oe(Pe({},p.product),{is_pack:P})),P){let v=this.productForm.get("current_stock");v&&(v.disable(),v.setValue(0))}this.imagePreview=p.product.image_url||null}}productForm;categories=[];availableParentProducts=[];loading=!1;isEdit=!1;imagePreview=null;imageFile=null;ngOnInit(){this.loadCategories(),this.loadParentProducts(),this.setupValidators(),this.setupPackValidators(),this.setupPriceValidation();let e=this.productForm.get("is_pack");if(e&&!e.value){let t=this.productForm.get("parent_product_id"),o=this.productForm.get("stock_multiplier");t&&o&&(t.clearValidators(),o.clearValidators(),t.updateValueAndValidity({emitEvent:!1}),o.updateValueAndValidity({emitEvent:!1}))}}loadCategories(){this.categoryService.getCategories().subscribe({next:e=>this.categories=e.data,error:e=>{console.error("Erro ao carregar categorias:",e),this.snackBar.open("Erro ao carregar categorias","Fechar",{duration:3e3})}})}loadParentProducts(){this.productService.getProducts({per_page:1e3,is_active:!0}).subscribe({next:e=>{this.availableParentProducts=e.data.filter(t=>!this.isEdit||t.id!==this.data.product?.id)},error:e=>{console.error("Erro ao carregar produtos para Pack:",e)}})}setupPackValidators(){let e=this.productForm.get("is_pack"),t=this.productForm.get("parent_product_id"),o=this.productForm.get("stock_multiplier"),l=this.productForm.get("current_stock");if(e&&t&&o&&l){let m=this.productForm.get("doses_por_garrafa"),p=this.productForm.get("dose_price"),P=this.productForm.get("can_sell_by_dose"),v=this.productForm.get("min_stock");e.valueChanges.subscribe(j=>{j?(t.setValidators([g.required]),o.setValidators([g.required,g.min(2)]),l.setValue(0),l.clearValidators(),l.setValidators([g.min(0)]),m&&(m.setValue(5),m.clearValidators(),m.setValidators([g.min(1)]),m.updateValueAndValidity({emitEvent:!1})),p&&(p.setValue(null),p.clearValidators(),p.updateValueAndValidity({emitEvent:!1})),P&&P.setValue(!1),v&&(v.setValue(0),v.clearValidators(),v.setValidators([g.min(0)]),v.updateValueAndValidity({emitEvent:!1}))):(t.clearValidators(),o.clearValidators(),t.setValue(null),o.setValue(1),l.clearValidators(),l.setValidators([g.required,g.min(0)]),m&&(m.clearValidators(),m.setValidators([g.required,g.min(1)]),m.updateValueAndValidity({emitEvent:!1})),v&&(v.clearValidators(),v.setValidators([g.required,g.min(0)]),v.updateValueAndValidity({emitEvent:!1}))),t.updateValueAndValidity({emitEvent:!1}),o.updateValueAndValidity({emitEvent:!1}),l.updateValueAndValidity({emitEvent:!1})}),e.value||(t.clearValidators(),o.clearValidators(),t.updateValueAndValidity({emitEvent:!1}),o.updateValueAndValidity({emitEvent:!1}))}}setupValidators(){let e=this.productForm.get("barcode");e&&e.valueChanges.subscribe(t=>{t&&this.productService.validateBarcode(t,this.data.product?.id).subscribe({next:o=>{o.valid||e.setErrors({barcodeExists:!0})}})})}setupPriceValidation(){let e=this.productForm.get("price"),t=this.productForm.get("original_price");if(e&&t){let o=()=>{let l=parseFloat(e.value),m=parseFloat(t.value);m&&!isNaN(m)&&!isNaN(l)&&m<=l?t.setErrors({mustBeGreaterThanPrice:!0}):t.hasError("mustBeGreaterThanPrice")&&t.updateValueAndValidity({emitEvent:!1})};e.valueChanges.subscribe(()=>o()),t.valueChanges.subscribe(()=>o())}}get discountInfo(){let e=parseFloat(this.productForm.get("price")?.value),t=parseFloat(this.productForm.get("original_price")?.value);if(!t||isNaN(t)||isNaN(e)||e<=0)return{show:!1,isValid:!1,percentage:0,originalPrice:0,finalPrice:0};let o=t>e,l=o?Math.round((t-e)/t*100):0;return{show:!0,isValid:o,percentage:l,originalPrice:t,finalPrice:e}}onImageSelected(e){let t=e.target.files?.[0];if(t){this.imageFile=t;let o=new FileReader;o.onload=()=>{this.imagePreview=o.result},o.readAsDataURL(t)}}removeImage(){this.imageFile=null,this.imagePreview=null,this.isEdit&&this.data.product?.image_url&&this.productService.deleteImage(this.data.product?.id||0).subscribe()}onSubmit(){if(this.productForm.valid){this.loading=!0;let e=this.productForm.getRawValue(),t={name:e.name??"",description:e.description??"",category_id:e.category_id,barcode:e.barcode??null,price:e.price,original_price:e.original_price??null,current_stock:e.is_pack?0:e.current_stock,min_stock:e.is_pack?0:e.min_stock,doses_por_garrafa:e.is_pack?5:e.doses_por_garrafa??5,can_sell_by_dose:e.is_pack?!1:e.can_sell_by_dose??!1,dose_price:e.is_pack?null:e.dose_price??null,parent_product_id:e.is_pack?e.parent_product_id:null,stock_multiplier:e.is_pack?e.stock_multiplier:1,is_active:e.is_active??!0,visible_online:e.visible_online??!0,featured:e.featured??!1,offers:e.offers??!1,popular:e.popular??!1};this.imageFile&&(t.image=this.imageFile),(this.isEdit?this.productService.updateProduct(Pe({id:this.data.product.id},t)):this.productService.createProduct(t)).subscribe({next:()=>{this.dialogRef.close(!0)},error:l=>{console.error("Erro ao salvar produto:",l),console.error("Resposta completa:",l.error),console.error("Dados enviados:",t);let m="Erro ao salvar produto";if(l.error){if(l.error.message)m=l.error.message;else if(l.error.errors){let p=l.error.errors,P=[];Object.entries(p).forEach(([v,F])=>{Array.isArray(F)&&P.push(`${v}: ${F.join(", ")}`)}),P.length>0?m=P.join(" | "):m="Erro de valida\xE7\xE3o. Verifique os dados."}}this.snackBar.open(m,"Fechar",{duration:7e3}),this.loading=!1}})}}resolvePreview(e){if(!e)return"";if(e.startsWith("data:")||e.startsWith("http://")||e.startsWith("https://"))return e;if(e.startsWith("/storage/")||e.startsWith("storage/")){let t=G.apiUrl.replace(/\/api$/,""),o=e.startsWith("/")?e:`/${e}`;return`${t}${o}`}return e}static \u0275fac=function(t){return new(t||n)(x(Ue),x(A),x(Ce),x(B),x(ue),x(Et))};static \u0275cmp=w({type:n,selectors:[["app-product-form-dialog"]],decls:106,vars:24,consts:[["fileInput",""],["mat-dialog-title",""],[3,"ngSubmit","formGroup"],[1,"form-container"],[1,"image-upload"],[1,"preview",3,"click"],["alt","Preview",3,"src",4,"ngIf"],[4,"ngIf"],[1,"overlay"],["type","file","accept","image/*",2,"display","none",3,"change"],["type","button","mat-icon-button","","color","warn",3,"click",4,"ngIf"],[1,"form-row"],["appearance","outline"],["matInput","","formControlName","name","required",""],["formControlName","category_id","required",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","description","rows","3"],[1,"pack-section"],[1,"pack-warning"],["formControlName","is_pack","color","primary"],["class","pack-config",4,"ngIf"],["matInput","","formControlName","barcode"],[1,"price-section"],["matInput","","type","number","formControlName","price","required","","min","0","step","0.01"],["matPrefix",""],["matInput","","type","number","formControlName","original_price","min","0","step","0.01","placeholder","Ex: De R$ 100,00"],["class","discount-feedback",4,"ngIf"],["appearance","outline",4,"ngIf"],["class","dose-section",4,"ngIf"],[1,"form-row","status-row"],[1,"toggle-wrapper"],["formControlName","is_active","color","primary"],["matTooltip","Se desligado, o produto some de todo o sistema (Site e Caixa). Use para itens fora de linha.","matTooltipPosition","right",1,"info-icon"],["formControlName","visible_online","color","primary"],["matTooltip","Se desligado, o produto fica oculto no site (Ecommerce), mas continua dispon\xEDvel para venda no Caixa (Balc\xE3o).","matTooltipPosition","right",1,"info-icon"],["formControlName","featured","color","accent"],["matTooltip","Exibe o produto na se\xE7\xE3o principal 'Destaques' da p\xE1gina inicial.","matTooltipPosition","right",1,"info-icon"],["formControlName","offers","color","warn"],["matTooltip","Adiciona uma etiqueta de promo\xE7\xE3o e exibe na se\xE7\xE3o de ofertas especiais.","matTooltipPosition","right",1,"info-icon"],["formControlName","popular","color","primary"],["matTooltip","Estes produtos aparecer\xE3o na lista 'N\xE3o esqueceu de nada?' na hora de finalizar a compra.","matTooltipPosition","right",1,"info-icon"],["align","end"],["type","button","mat-button","",3,"click","disabled"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],["alt","Preview",3,"src"],["type","button","mat-icon-button","","color","warn",3,"click"],[3,"value"],[1,"pack-config"],["formControlName","parent_product_id","required",""],["matInput","","type","number","formControlName","stock_multiplier","required","","min","2",3,"disabled"],[1,"discount-feedback"],["class","feedback-success",4,"ngIf"],["class","feedback-error",4,"ngIf"],[1,"feedback-success"],[1,"feedback-error"],["matInput","","type","number","formControlName","current_stock","required","","min","0"],["matInput","","type","number","formControlName","min_stock","required","","min","0"],[1,"dose-section"],["matInput","","type","number","formControlName","doses_por_garrafa","required","","min","1"],["matInput","","type","number","formControlName","dose_price","min","0","step","0.01"],["formControlName","can_sell_by_dose","color","primary"],["diameter","20"]],template:function(t,o){if(t&1){let l=y();r(0,"h2",1),a(1),i(),r(2,"form",2),u("ngSubmit",function(){return f(l),_(o.onSubmit())}),r(3,"mat-dialog-content")(4,"div",3)(5,"div",4)(6,"div",5),u("click",function(){f(l);let p=I(13);return _(p.click())}),d(7,Qt,1,1,"img",6)(8,Ut,2,0,"mat-icon",7),r(9,"div",8)(10,"mat-icon"),a(11,"edit"),i()()(),r(12,"input",9,0),u("change",function(p){return f(l),_(o.onImageSelected(p))}),i(),d(14,Gt,3,0,"button",10),i(),r(15,"div",11)(16,"mat-form-field",12)(17,"mat-label"),a(18,"Nome"),i(),C(19,"input",13),d(20,Xt,2,0,"mat-error",7),i(),r(21,"mat-form-field",12)(22,"mat-label"),a(23,"Categoria"),i(),r(24,"mat-select",14),d(25,Kt,2,2,"mat-option",15),i(),d(26,Jt,2,0,"mat-error",7),i()(),r(27,"mat-form-field",12)(28,"mat-label"),a(29,"Descri\xE7\xE3o"),i(),C(30,"textarea",16),i(),r(31,"div",17)(32,"h3"),a(33,"Configura\xE7\xE3o de Pack (Caixa/Fardo)"),i(),r(34,"p",18)(35,"mat-icon"),a(36,"info"),i(),a(37," Use esta op\xE7\xE3o apenas para Caixas/Fardos. "),i(),r(38,"mat-slide-toggle",19),a(39," Este produto \xE9 um Pack (desconta estoque do produto pai) "),i(),d(40,ii,18,6,"div",20),i(),r(41,"div",11)(42,"mat-form-field",12)(43,"mat-label"),a(44,"C\xF3digo de Barras"),i(),C(45,"input",21),d(46,oi,2,0,"mat-error",7),i()(),r(47,"div",22)(48,"div",11)(49,"mat-form-field",12)(50,"mat-label"),a(51,"Pre\xE7o de Venda (Final)"),i(),C(52,"input",23),r(53,"span",24),a(54,"R$\xA0"),i(),r(55,"mat-hint"),a(56,"Valor que o cliente pagar\xE1"),i(),d(57,ri,2,0,"mat-error",7)(58,ni,2,0,"mat-error",7),i(),r(59,"mat-form-field",12)(60,"mat-label"),a(61,"Pre\xE7o Original / Tabela"),i(),C(62,"input",25),r(63,"span",24),a(64,"R$\xA0"),i(),r(65,"mat-hint"),a(66,"Pre\xE7o antes do desconto (opcional)"),i(),d(67,ai,2,0,"mat-error",7)(68,li,2,0,"mat-error",7),i()(),d(69,si,3,2,"div",26),i(),r(70,"div",11),d(71,ui,6,2,"mat-form-field",27)(72,_i,6,2,"mat-form-field",27),i(),d(73,xi,19,3,"div",28),r(74,"div",29)(75,"div",30)(76,"mat-slide-toggle",31),a(77," Produto Ativo "),i(),r(78,"mat-icon",32),a(79," help_outline "),i()(),r(80,"div",30)(81,"mat-slide-toggle",33),a(82," Vis\xEDvel no Site/App "),i(),r(83,"mat-icon",34),a(84," help_outline "),i()(),r(85,"div",30)(86,"mat-slide-toggle",35),a(87," Produto em Destaque "),i(),r(88,"mat-icon",36),a(89," help_outline "),i()(),r(90,"div",30)(91,"mat-slide-toggle",37),a(92," Produto em Oferta "),i(),r(93,"mat-icon",38),a(94," help_outline "),i()(),r(95,"div",30)(96,"mat-slide-toggle",39),a(97," Exibir como Sugest\xE3o no Checkout "),i(),r(98,"mat-icon",40),a(99," help_outline "),i()()()()(),r(100,"mat-dialog-actions",41)(101,"button",42),u("click",function(){return f(l),_(o.dialogRef.close())}),a(102," Cancelar "),i(),r(103,"button",43),d(104,Pi,2,0,"mat-icon",7)(105,bi,2,1,"span",7),i()()()}if(t&2){let l,m,p,P,v,F,j,Fe,we,Ie,De;c(),b("",o.isEdit?"Editar":"Novo"," Produto"),c(),s("formGroup",o.productForm),c(4),z("has-image",o.imagePreview),c(),s("ngIf",o.imagePreview),c(),s("ngIf",!o.imagePreview),c(6),s("ngIf",o.imagePreview),c(6),s("ngIf",(l=o.productForm.get("name"))==null?null:l.hasError("required")),c(5),s("ngForOf",o.categories),c(),s("ngIf",(m=o.productForm.get("category_id"))==null?null:m.hasError("required")),c(14),s("ngIf",(p=o.productForm.get("is_pack"))==null?null:p.value),c(6),s("ngIf",(P=o.productForm.get("barcode"))==null?null:P.hasError("barcodeExists")),c(11),s("ngIf",(v=o.productForm.get("price"))==null?null:v.hasError("required")),c(),s("ngIf",(F=o.productForm.get("price"))==null?null:F.hasError("min")),c(9),s("ngIf",(j=o.productForm.get("original_price"))==null?null:j.hasError("min")),c(),s("ngIf",(Fe=o.productForm.get("original_price"))==null?null:Fe.hasError("mustBeGreaterThanPrice")),c(),s("ngIf",o.discountInfo.show),c(2),s("ngIf",!((we=o.productForm.get("is_pack"))!=null&&we.value)),c(),s("ngIf",!((Ie=o.productForm.get("is_pack"))!=null&&Ie.value)),c(),s("ngIf",!((De=o.productForm.get("is_pack"))!=null&&De.value)),c(28),s("disabled",o.loading),c(2),s("disabled",o.productForm.invalid||o.loading),c(),s("ngIf",o.loading),c(),s("ngIf",!o.loading)}},dependencies:[O,U,D,Ne,Y,je,K,Le,J,$e,Qe,We,ze,He,$,ge,_e,fe,V,T,X,ie,te,ee,ut,pt,gt,re,oe,le,ae,ne,yt,St,pe,de,N,q,me,ce,R],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;padding:16px 0}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px}.form-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}.status-row[_ngcontent-%COMP%]{margin-top:8px;background-color:transparent!important}.toggle-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;flex:1}.toggle-wrapper[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{flex:1}.info-icon[_ngcontent-%COMP%]{color:#999;font-size:18px;width:18px;height:18px;cursor:help;flex-shrink:0;margin-left:4px}.info-icon[_ngcontent-%COMP%]:hover{color:var(--primary, #673ab7)}[_nghost-%COMP%]     .status-row mat-slide-toggle{background-color:transparent!important}[_nghost-%COMP%]     .status-row .mat-mdc-slide-toggle{background-color:transparent!important}[_nghost-%COMP%]     .status-row .mdc-switch{background-color:transparent!important}.pack-section[_ngcontent-%COMP%]{margin-top:24px;padding:16px;background-color:#f9f9f9!important;border-radius:8px;border:1px solid #ddd;border-left:4px solid var(--primary, #673ab7)}[_nghost-%COMP%]     .pack-section .mat-mdc-slide-toggle, [_nghost-%COMP%]     .pack-section .mat-mdc-form-field{background-color:transparent!important}.pack-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 12px;color:#333;font-size:16px;font-weight:500}.pack-warning[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:0 0 16px;padding:12px;background-color:#fff;border-left:4px solid var(--primary, #673ab7);border-radius:4px;color:#666;font-size:14px}.pack-warning[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--primary, #673ab7)}.pack-config[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid #ddd}.dose-section[_ngcontent-%COMP%]{margin-top:24px;padding:16px;background-color:#f9f9f9!important;border-radius:8px;border:1px solid #ddd;border-left:4px solid var(--primary, #673ab7)}[_nghost-%COMP%]     .dose-section .mat-mdc-slide-toggle, [_nghost-%COMP%]     .dose-section .mat-mdc-form-field{background-color:transparent!important}.dose-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;color:#333;font-size:16px;font-weight:500}.image-upload[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.preview[_ngcontent-%COMP%]{width:150px;height:150px;border:2px dashed #ccc;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden}.preview.has-image[_ngcontent-%COMP%]{border-style:solid}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.preview[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s}.preview[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.preview[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff}[_nghost-%COMP%]     mat-dialog-content .mat-mdc-form-field{background-color:#fff!important}[_nghost-%COMP%]     mat-dialog-content .mat-mdc-form-field .mat-mdc-text-field-wrapper{background-color:#fff!important}[_nghost-%COMP%]     mat-dialog-content .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-flex{background-color:#fff!important}[_nghost-%COMP%]     mat-dialog-content .mat-mdc-form-field .mat-mdc-form-field-focus-overlay{background-color:#fff!important}[_nghost-%COMP%]     mat-dialog-content .mat-mdc-form-field .mat-mdc-form-field-input-control input, [_nghost-%COMP%]     mat-dialog-content .mat-mdc-form-field .mat-mdc-form-field-input-control textarea{background-color:#fff!important}[_nghost-%COMP%]     mat-dialog-content .mat-mdc-form-field .mdc-notched-outline{border-color:#0000001f!important}[_nghost-%COMP%]     mat-dialog-content .mat-mdc-form-field .mdc-notched-outline__notch{border-color:#0000001f!important}[_nghost-%COMP%]     mat-dialog-content .mat-mdc-form-field{box-shadow:0 1px 3px #00000014!important;border-radius:4px}.price-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.discount-feedback[_ngcontent-%COMP%]{margin-top:8px;padding:12px;border-radius:4px;display:flex;align-items:center;gap:8px;font-size:14px}.feedback-success[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32;border-left:4px solid #4caf50}.feedback-success[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#4caf50}.feedback-success[_ngcontent-%COMP%]   del[_ngcontent-%COMP%]{color:#666;margin:0 4px}.feedback-error[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828;border-left:4px solid #f44336}.feedback-error[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#f44336}.discount-feedback[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}@media (max-width: 600px){.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:0}.preview[_ngcontent-%COMP%]{width:100px;height:100px}}"]})};function Ei(n,e){n&1&&(E(0),r(1,"p"),a(2,"Arraste e solte seu arquivo aqui"),i(),r(3,"p"),a(4,"ou"),i(),r(5,"p"),a(6,"clique para selecionar"),i(),r(7,"small"),a(8,"Formatos aceitos: CSV, XLSX"),i(),M())}function Mi(n,e){if(n&1&&(E(0),r(1,"p"),a(2),i(),r(3,"small"),a(4),i(),M()),n&2){let t=h();c(2),S(t.selectedFile.name),c(2),S(t.formatFileSize(t.selectedFile.size))}}function Si(n,e){n&1&&C(0,"mat-progress-bar",13)}var xe=class n{constructor(e,t,o){this.dialogRef=e;this.productService=t;this.snackBar=o}selectedFile=null;isDragging=!1;importing=!1;onDragOver(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!0}onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!1}onDrop(e){e.preventDefault(),e.stopPropagation(),this.isDragging=!1;let t=e.dataTransfer?.files;t?.length&&this.handleFile(t[0])}onFileSelected(e){let t=e.target.files?.[0];t&&this.handleFile(t)}handleFile(e){if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(e.type)){this.snackBar.open("Formato de arquivo inv\xE1lido. Use CSV ou XLSX.","Fechar",{duration:3e3});return}this.selectedFile=e}importFile(){this.selectedFile&&(this.importing=!0,this.productService.importProducts(this.selectedFile).subscribe({next:e=>{e.errors.length>0?this.snackBar.open(`Importa\xE7\xE3o conclu\xEDda com ${e.errors.length} erros. Verifique o log.`,"Fechar",{duration:5e3}):this.snackBar.open(`${e.imported} produtos importados com sucesso!`,"Fechar",{duration:3e3}),this.dialogRef.close(!0)},error:e=>{console.error("Erro na importa\xE7\xE3o:",e),this.snackBar.open("Erro ao importar produtos","Fechar",{duration:3e3}),this.importing=!1}}))}downloadTemplate(e){this.productService.exportProducts(e).subscribe({next:t=>{let o=window.URL.createObjectURL(t),l=document.createElement("a");l.href=o,l.download=`template_produtos.${e}`,l.click(),window.URL.revokeObjectURL(o)},error:t=>{console.error("Erro ao baixar template:",t),this.snackBar.open("Erro ao baixar template","Fechar",{duration:3e3})}})}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,o=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,l)).toFixed(2))+" "+o[l]}static \u0275fac=function(t){return new(t||n)(x(ue),x(A),x(B))};static \u0275cmp=w({type:n,selectors:[["app-product-import-dialog"]],decls:29,vars:10,consts:[["fileInput",""],["mat-dialog-title",""],[1,"import-container"],[1,"upload-area",3,"dragover","dragleave","drop","click"],["type","file","accept",".csv,.xlsx",2,"display","none",3,"change"],[1,"upload-text"],[4,"ngIf"],[1,"template-section"],["mat-stroked-button","",3,"click"],["mode","indeterminate",4,"ngIf"],["align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["mode","indeterminate"]],template:function(t,o){if(t&1){let l=y();r(0,"h2",1),a(1,"Importar Produtos"),i(),r(2,"mat-dialog-content")(3,"div",2)(4,"div",3),u("dragover",function(p){return f(l),_(o.onDragOver(p))})("dragleave",function(p){return f(l),_(o.onDragLeave(p))})("drop",function(p){return f(l),_(o.onDrop(p))})("click",function(){f(l);let p=I(6);return _(p.click())}),r(5,"input",4,0),u("change",function(p){return f(l),_(o.onFileSelected(p))}),i(),r(7,"mat-icon"),a(8),i(),r(9,"div",5),d(10,Ei,9,0,"ng-container",6)(11,Mi,5,2,"ng-container",6),i()(),r(12,"div",7)(13,"p"),a(14,"Baixe nosso template para importa\xE7\xE3o:"),i(),r(15,"button",8),u("click",function(){return f(l),_(o.downloadTemplate("xlsx"))}),r(16,"mat-icon"),a(17,"download"),i(),a(18," Template XLSX "),i(),r(19,"button",8),u("click",function(){return f(l),_(o.downloadTemplate("csv"))}),r(20,"mat-icon"),a(21,"download"),i(),a(22," Template CSV "),i()(),d(23,Si,1,0,"mat-progress-bar",9),i()(),r(24,"mat-dialog-actions",10)(25,"button",11),u("click",function(){return f(l),_(o.dialogRef.close())}),a(26," Cancelar "),i(),r(27,"button",12),u("click",function(){return f(l),_(o.importFile())}),a(28," Importar "),i()()}t&2&&(c(4),z("drag-over",o.isDragging)("has-file",o.selectedFile),c(4),S(o.selectedFile?"description":"cloud_upload"),c(2),s("ngIf",!o.selectedFile),c(),s("ngIf",o.selectedFile),c(12),s("ngIf",o.importing),c(2),s("disabled",o.importing),c(2),s("disabled",!o.selectedFile||o.importing))},dependencies:[O,D,$,ge,_e,fe,V,T,N,q,bt,Pt,R],styles:[".import-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;padding:16px 0}.upload-area[_ngcontent-%COMP%]{border:2px dashed #ccc;border-radius:8px;padding:32px;text-align:center;cursor:pointer;transition:all .2s ease}.upload-area.drag-over[_ngcontent-%COMP%]{border-color:#3f51b5;background-color:#3f51b50d}.upload-area.has-file[_ngcontent-%COMP%]{border-style:solid;border-color:#4caf50;background-color:#4caf500d}.upload-area[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:#666;margin-bottom:16px}.upload-text[_ngcontent-%COMP%]{color:#666}.upload-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0}.upload-text[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#999}.template-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.template-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666}@media (max-width: 600px){.template-section[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}"]})};var yi=()=>[10,25,50,100];function ki(n,e){if(n&1&&(r(0,"mat-option",13),a(1),i()),n&2){let t=e.$implicit;s("value",t.id),c(),b(" ",t.name," ")}}function Fi(n,e){if(n&1){let t=y();r(0,"button",26),u("click",function(){f(t);let l=h();return _(l.clearFilters())}),r(1,"mat-icon"),a(2,"filter_alt_off"),i()()}}function wi(n,e){n&1&&(r(0,"div",27),C(1,"mat-spinner",28),r(2,"p"),a(3,"Carregando produtos..."),i()())}function Ii(n,e){n&1&&(r(0,"th",49),a(1,"Imagem"),i())}function Di(n,e){if(n&1&&(r(0,"td",50)(1,"div",51),C(2,"img",52),i()()),n&2){let t=e.$implicit,o=h(2);c(2),s("src",o.getImageUrl(t),L)("alt",t.name)}}function Oi(n,e){n&1&&(r(0,"th",53),a(1,"Nome"),i())}function Ti(n,e){if(n&1&&(r(0,"td",50)(1,"div",54),a(2),i()()),n&2){let t=e.$implicit;c(2),b(" ",t.name," ")}}function Vi(n,e){n&1&&(r(0,"th",55),a(1,"Categoria"),i())}function Bi(n,e){if(n&1&&(r(0,"td",50),a(1),i()),n&2){let t=e.$implicit;c(),S(t.category==null?null:t.category.name)}}function Ri(n,e){n&1&&(r(0,"th",56),a(1,"Pre\xE7o"),i())}function qi(n,e){if(n&1&&(r(0,"td",50),a(1),i()),n&2){let t=e.$implicit,o=h(2);c(),S(o.formatCurrency(t.price))}}function Ni(n,e){n&1&&(r(0,"th",57),a(1,"Estoque"),i())}function $i(n,e){if(n&1&&(r(0,"td",50)(1,"span"),a(2),i()()),n&2){let t=e.$implicit,o=h(2);c(),Be("color",o.getStockColor(t.current_stock,t.min_stock)),c(),b(" ",t.current_stock," ")}}function Ai(n,e){n&1&&(r(0,"th",58),a(1,"Status"),i())}function ji(n,e){if(n&1&&(r(0,"td",50)(1,"mat-chip",59),a(2),i()()),n&2){let t=e.$implicit;c(),s("color",t.is_active?"primary":"warn"),c(),b(" ",t.is_active?"Ativo":"Inativo"," ")}}function Li(n,e){n&1&&(r(0,"th",49),a(1,"A\xE7\xF5es"),i())}function zi(n,e){if(n&1){let t=y();r(0,"td",50)(1,"button",60)(2,"mat-icon"),a(3,"more_vert"),i()(),r(4,"mat-menu",null,0)(6,"button",61),u("click",function(){let l=f(t).$implicit,m=h(2);return _(m.openProductDialog(l))}),r(7,"mat-icon"),a(8,"edit"),i(),r(9,"span"),a(10,"Editar"),i()(),r(11,"button",61),u("click",function(){let l=f(t).$implicit,m=h(2);return _(m.toggleStatus(l))}),r(12,"mat-icon"),a(13),i(),r(14,"span"),a(15),i()(),r(16,"button",62),u("click",function(){let l=f(t).$implicit,m=h(2);return _(m.deleteProduct(l))}),r(17,"mat-icon"),a(18,"delete"),i(),r(19,"span"),a(20,"Excluir"),i()()()()}if(n&2){let t=e.$implicit,o=I(5);c(),s("matMenuTriggerFor",o),c(12),S(t.is_active?"visibility_off":"visibility"),c(2),S(t.is_active?"Desativar":"Ativar")}}function Hi(n,e){n&1&&C(0,"tr",63)}function Wi(n,e){n&1&&C(0,"tr",64)}function Qi(n,e){n&1&&(r(0,"div",65)(1,"mat-icon"),a(2,"inventory_2"),i(),r(3,"p"),a(4,"Nenhum produto encontrado"),i()())}function Ui(n,e){if(n&1){let t=y();r(0,"mat-card",29)(1,"mat-card-content")(2,"table",30),u("matSortChange",function(l){f(t);let m=h();return _(m.onSortChange(l))}),E(3,31),d(4,Ii,2,0,"th",32)(5,Di,3,2,"td",33),M(),E(6,34),d(7,Oi,2,0,"th",35)(8,Ti,3,1,"td",33),M(),E(9,36),d(10,Vi,2,0,"th",37)(11,Bi,2,1,"td",33),M(),E(12,38),d(13,Ri,2,0,"th",39)(14,qi,2,1,"td",33),M(),E(15,40),d(16,Ni,2,0,"th",41)(17,$i,3,3,"td",33),M(),E(18,42),d(19,Ai,2,0,"th",43)(20,ji,3,2,"td",33),M(),E(21,44),d(22,Li,2,0,"th",32)(23,zi,21,3,"td",33),M(),d(24,Hi,1,0,"tr",45)(25,Wi,1,0,"tr",46),i(),d(26,Qi,5,0,"div",47),r(27,"mat-paginator",48),u("page",function(l){f(t);let m=h();return _(m.onPageChange(l))}),i()()()}if(n&2){let t=h();c(2),s("dataSource",t.products),c(22),s("matHeaderRowDef",t.displayedColumns),c(),s("matRowDefColumns",t.displayedColumns),c(),s("ngIf",t.products.length===0),c(),s("length",t.totalItems)("pageSize",t.pageSize)("pageIndex",t.currentPage)("pageSizeOptions",Re(8,yi))}}var Nt=class n{constructor(e,t,o,l,m){this.productService=e;this.categoryService=t;this.dialog=o;this.snackBar=l;this.cdr=m;this.searchSubject.pipe(Te(300),Ve(),k(this.destroy$)).subscribe(()=>{this.currentPage=0,this.loadProducts()})}displayedColumns=["image","name","category","price","current_stock","status","actions"];products=[];totalItems=0;pageSize=10;currentPage=0;loading=!0;searchTerm="";selectedCategory=null;showInactive=!1;showLowStock=!1;filterFeatured=!1;filterOffers=!1;filterIsPack=!1;filterVisibleOnline=!1;categories=[];currentSortColumn="";currentSortDirection="";isClearingFilters=!1;paginator;sort;table;destroy$=new be;searchSubject=new be;getImageUrl(e){let t=e.image_url;if(!t)return"assets/images/no-image.png";if(t.startsWith("http://")||t.startsWith("https://"))return`${t}?v=${encodeURIComponent(e.updated_at)}`;if(t.startsWith("/storage/")||t.startsWith("storage/")){let o=G.apiUrl.replace(/\/api$/,""),l=t.startsWith("/")?t:`/${t}`;return`${o}${l}?v=${encodeURIComponent(e.updated_at)}`}return`${t}?v=${encodeURIComponent(e.updated_at)}`}ngOnInit(){this.loadCategories(),this.loadProducts()}ngAfterViewInit(){this.sort}loadCategories(){this.categoryService.getAllCategories().pipe(k(this.destroy$)).subscribe({next:e=>{this.categories=e},error:e=>{console.error("Erro ao carregar categorias:",e),this.snackBar.open("Erro ao carregar categorias","Fechar",{duration:3e3})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadProducts(){this.loading=!0;let e={page:this.currentPage+1,per_page:this.pageSize};this.searchTerm&&(e.search=this.searchTerm),this.selectedCategory&&(e.category_id=this.selectedCategory),this.showInactive||(e.is_active=!0),this.showLowStock&&(e.low_stock=!0),this.filterFeatured&&(e.featured=!0),this.filterOffers&&(e.offers=!0),this.filterIsPack&&(e.is_pack=!0),this.filterVisibleOnline&&(e.visible_online=!0),this.currentSortColumn&&this.currentSortDirection&&(e.sort_by=this.currentSortColumn,e.sort_order=this.currentSortDirection),this.productService.getProducts(e).pipe(k(this.destroy$)).subscribe({next:t=>{this.products=t.data,this.totalItems=t.total,this.loading=!1},error:t=>{console.error("Erro ao carregar produtos:",t),this.snackBar.open("Erro ao carregar produtos","Fechar",{duration:3e3}),this.loading=!1}})}onSearch(e){this.searchTerm=e.target.value,this.searchSubject.next(this.searchTerm)}onPageChange(e){this.pageSize=e.pageSize,this.currentPage=e.pageIndex,this.loadProducts()}onSortChange(e){e.active===this.currentSortColumn?this.currentSortDirection==="asc"?this.currentSortDirection="desc":this.currentSortDirection==="desc"?(this.currentSortColumn="",this.currentSortDirection=""):(this.currentSortColumn=e.active,this.currentSortDirection="asc"):(this.currentSortColumn=e.active,this.currentSortDirection=e.direction||"asc"),this.sort&&(this.sort.active=this.currentSortColumn,this.sort.direction=this.currentSortDirection),this.currentPage=0,this.loadProducts()}onCategoryChange(){this.isClearingFilters||(this.currentPage=0,this.loadProducts())}toggleFilters(e){this.isClearingFilters||(e==="inactive"?this.showInactive=!this.showInactive:this.showLowStock=!this.showLowStock,this.currentPage=0,this.loadProducts())}onFilterChange(e,t){if(this.isClearingFilters)return;let o=t.selected;switch(e){case"featured":this.filterFeatured=o;break;case"offers":this.filterOffers=o;break;case"is_pack":this.filterIsPack=o;break;case"visible_online":this.filterVisibleOnline=o;break}this.currentPage=0,this.loadProducts()}hasActiveFilters(){return this.showInactive||this.showLowStock||this.filterFeatured||this.filterOffers||this.filterIsPack||this.filterVisibleOnline||!!this.searchTerm||!!this.selectedCategory}clearFilters(){this.isClearingFilters=!0,this.searchTerm="",this.selectedCategory=null,this.showInactive=!1,this.showLowStock=!1,this.filterFeatured=!1,this.filterOffers=!1,this.filterIsPack=!1,this.filterVisibleOnline=!1,this.currentPage=0,this.currentSortColumn="",this.currentSortDirection="",this.sort&&(this.sort.active="",this.sort.direction=""),setTimeout(()=>{this.isClearingFilters=!1,this.cdr.detectChanges(),this.loadProducts()},0)}openProductDialog(e){this.dialog.open(ve,{width:"800px",data:{product:e}}).afterClosed().subscribe(o=>{o&&(this.loadProducts(),this.snackBar.open(e?"Produto atualizado com sucesso":"Produto criado com sucesso","Fechar",{duration:3e3}))})}deleteProduct(e){this.dialog.open(wt,{width:"400px",data:{title:"Confirmar Exclus\xE3o",message:`Deseja realmente excluir o produto "${e.name}"?`,confirmText:"Excluir",cancelText:"Cancelar"}}).afterClosed().subscribe(o=>{o&&this.productService.deleteProduct(e.id).pipe(k(this.destroy$)).subscribe({next:()=>{this.loadProducts(),this.snackBar.open("Produto exclu\xEDdo com sucesso","Fechar",{duration:3e3})},error:l=>{console.error("Erro ao excluir produto:",l);let m="Erro ao excluir produto";l.error&&l.error.error?m=l.error.error:l.status===400?m="N\xE3o \xE9 poss\xEDvel excluir produto com pedidos associados":l.status===403?m="Acesso n\xE3o autorizado":l.status===404&&(m="Produto n\xE3o encontrado"),this.snackBar.open(m,"Fechar",{duration:5e3,panelClass:["error-snackbar"]})}})})}toggleStatus(e){this.productService.toggleStatus(e.id).pipe(k(this.destroy$)).subscribe({next:()=>{this.loadProducts(),this.snackBar.open(`Produto ${e.is_active?"desativado":"ativado"} com sucesso`,"Fechar",{duration:3e3})},error:t=>{console.error("Erro ao alterar status do produto:",t),this.snackBar.open("Erro ao alterar status do produto","Fechar",{duration:3e3})}})}openImportDialog(){this.dialog.open(xe,{width:"500px"}).afterClosed().subscribe(t=>{t&&this.loadProducts()})}exportProducts(e){this.productService.exportProducts(e).pipe(k(this.destroy$)).subscribe({next:t=>{let o=window.URL.createObjectURL(t),l=document.createElement("a");l.href=o,l.download=`produtos.${e}`,l.click(),window.URL.revokeObjectURL(o)},error:t=>{console.error("Erro ao exportar produtos:",t),this.snackBar.open("Erro ao exportar produtos","Fechar",{duration:3e3})}})}formatCurrency(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}getStockColor(e,t){return e===0?"#f44336":e<=t?"#ff9800":"#4caf50"}static \u0275fac=function(t){return new(t||n)(x(A),x(Ce),x(Mt),x(B),x(qe))};static \u0275cmp=w({type:n,selectors:[["app-produtos"]],viewQuery:function(t,o){if(t&1&&(H(se,5),H(he,5),H(Z,5)),t&2){let l;W(l=Q())&&(o.paginator=l.first),W(l=Q())&&(o.sort=l.first),W(l=Q())&&(o.table=l.first)}},decls:44,vars:13,consts:[["menu","matMenu"],[1,"produtos-container"],[1,"produtos-header"],[1,"header-actions"],["mat-raised-button","","color","accent",3,"click"],[1,"filters-card"],[1,"filters-container"],[1,"filters-main"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Nome ou c\xF3digo de barras",3,"ngModelChange","keyup","ngModel"],["matSuffix",""],["appearance","outline"],[3,"ngModelChange","selectionChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"filters-actions"],[1,"filter-toggles"],["matTooltip","Inclui produtos desativados na listagem.","matTooltipPosition","below",3,"selectionChange","selected"],["color","warn","matTooltip","Exibe apenas produtos com estoque abaixo do m\xEDnimo.","matTooltipPosition","below",3,"selectionChange","selected"],["matTooltip","Exibe apenas produtos em destaque na p\xE1gina inicial.","matTooltipPosition","below",3,"selectionChange","selected"],["matTooltip","Exibe apenas produtos em oferta/promo\xE7\xE3o.","matTooltipPosition","below",3,"selectionChange","selected"],["matTooltip","Exibe apenas produtos vendidos em pack/fardo.","matTooltipPosition","below",3,"selectionChange","selected"],["matTooltip","Exibe apenas produtos que aparecem no ecommerce.","matTooltipPosition","below",3,"selectionChange","selected"],["mat-icon-button","","color","primary","matTooltip","Limpar todos os filtros","matTooltipPosition","below","class","clear-filters-btn",3,"click",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","table-card",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","Limpar todos os filtros","matTooltipPosition","below",1,"clear-filters-btn",3,"click"],[1,"loading-container"],["diameter","50"],[1,"table-card"],["mat-table","","matSort","",3,"matSortChange","dataSource"],["matColumnDef","image"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","name",4,"matHeaderCellDef"],["matColumnDef","category"],["mat-header-cell","","mat-sort-header","category",4,"matHeaderCellDef"],["matColumnDef","price"],["mat-header-cell","","mat-sort-header","price",4,"matHeaderCellDef"],["matColumnDef","current_stock"],["mat-header-cell","","mat-sort-header","current_stock",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","mat-sort-header","is_active",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","empty-state",4,"ngIf"],[3,"page","length","pageSize","pageIndex","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],[1,"product-image"],["width","40","height","40",3,"src","alt"],["mat-header-cell","","mat-sort-header","name"],[1,"product-name"],["mat-header-cell","","mat-sort-header","category"],["mat-header-cell","","mat-sort-header","price"],["mat-header-cell","","mat-sort-header","current_stock"],["mat-header-cell","","mat-sort-header","is_active"],["selected","",3,"color"],["mat-icon-button","","aria-label","A\xE7\xF5es",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[1,"empty-state"]],template:function(t,o){t&1&&(r(0,"div",1)(1,"div",2)(2,"h1"),a(3,"Produtos"),i(),r(4,"div",3)(5,"button",4),u("click",function(){return o.openProductDialog()}),r(6,"mat-icon"),a(7,"add"),i(),a(8," Novo Produto "),i()()(),r(9,"mat-card",5)(10,"mat-card-content")(11,"div",6)(12,"div",7)(13,"mat-form-field",8)(14,"mat-label"),a(15,"Buscar produtos"),i(),r(16,"input",9),Se("ngModelChange",function(m){return Me(o.searchTerm,m)||(o.searchTerm=m),m}),u("keyup",function(m){return o.onSearch(m)}),i(),r(17,"mat-icon",10),a(18,"search"),i()(),r(19,"mat-form-field",11)(20,"mat-label"),a(21,"Categoria"),i(),r(22,"mat-select",12),Se("ngModelChange",function(m){return Me(o.selectedCategory,m)||(o.selectedCategory=m),m}),u("selectionChange",function(){return o.onCategoryChange()}),r(23,"mat-option",13),a(24,"Todas"),i(),d(25,ki,2,2,"mat-option",14),i()()(),r(26,"div",15)(27,"div",16)(28,"mat-chip-listbox")(29,"mat-chip-option",17),u("selectionChange",function(){return o.toggleFilters("inactive")}),a(30," Inativos "),i(),r(31,"mat-chip-option",18),u("selectionChange",function(){return o.toggleFilters("lowStock")}),a(32," Estoque Baixo "),i(),r(33,"mat-chip-option",19),u("selectionChange",function(m){return o.onFilterChange("featured",m)}),a(34," Destaques "),i(),r(35,"mat-chip-option",20),u("selectionChange",function(m){return o.onFilterChange("offers",m)}),a(36," Em Oferta "),i(),r(37,"mat-chip-option",21),u("selectionChange",function(m){return o.onFilterChange("is_pack",m)}),a(38," Caixas / Fardos "),i(),r(39,"mat-chip-option",22),u("selectionChange",function(m){return o.onFilterChange("visible_online",m)}),a(40," Vis\xEDveis no Site "),i()()(),d(41,Fi,3,0,"button",23),i()()()(),d(42,wi,4,0,"div",24)(43,Ui,28,9,"mat-card",25),i()),t&2&&(c(16),Ee("ngModel",o.searchTerm),c(6),Ee("ngModel",o.selectedCategory),c(),s("value",null),c(2),s("ngForOf",o.categories),c(4),s("selected",o.showInactive),c(2),s("selected",o.showLowStock),c(2),s("selected",o.filterFeatured),c(2),s("selected",o.filterOffers),c(2),s("selected",o.filterIsPack),c(2),s("selected",o.filterVisibleOnline),c(2),s("ngIf",o.hasActiveFilters()),c(),s("ngIf",o.loading),c(),s("ngIf",!o.loading))},dependencies:[tt,Ze,et,O,U,D,Ge,K,J,Ae,Y,dt,Z,ot,lt,rt,it,ct,nt,at,mt,st,_t,se,Ft,he,kt,re,oe,te,ee,ft,ie,V,T,X,N,q,Ye,Ke,Xe,Je,$,R,le,ae,ne,xt,ht,vt,Ct,me,ce,pe,de],styles:[".produtos-container[_ngcontent-%COMP%]{padding:20px}.produtos-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.produtos-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:24px;color:#333}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.filters-card[_ngcontent-%COMP%]{margin-bottom:20px;box-shadow:0 1px 3px #00000014!important}.filters-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px!important}.filters-container[_ngcontent-%COMP%]{display:flex!important;flex-direction:column!important;gap:16px!important;padding:0!important}.filters-main[_ngcontent-%COMP%]{display:flex!important;flex-wrap:wrap!important;gap:12px!important;align-items:center!important}.filters-main[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:0 1 auto;margin:0!important}.search-field[_ngcontent-%COMP%]{flex:1;min-width:200px}.filters-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex-wrap:wrap}.filter-toggles[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;flex-wrap:wrap;flex:1}.clear-filters-btn[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]     .filter-toggles mat-chip-listbox{display:flex;gap:12px;flex-wrap:wrap}[_nghost-%COMP%]     .filter-toggles .mat-mdc-chip-option{border:1px solid rgba(0,0,0,.12)!important;background-color:transparent!important;color:#000000de!important;transition:all .2s ease;margin:0!important}[_nghost-%COMP%]     .filter-toggles .mat-mdc-chip-option:hover:not(.mdc-evolution-chip--selected){background-color:#0000000a!important;border-color:#0003!important}[_nghost-%COMP%]     .filter-toggles .mat-mdc-chip-option.mdc-evolution-chip--selected{background-color:var(--primary, #673ab7)!important;border-color:var(--primary, #673ab7)!important;color:#fff!important}[_nghost-%COMP%]     .filter-toggles .mat-mdc-chip-option.mdc-evolution-chip--selected:hover{background-color:var(--primary-dark, #512da8)!important;border-color:var(--primary-dark, #512da8)!important}[_nghost-%COMP%]     .filter-toggles .mat-mdc-chip-option[color=warn]{border-color:#f4433680!important}[_nghost-%COMP%]     .filter-toggles .mat-mdc-chip-option[color=warn]:hover:not(.mdc-evolution-chip--selected){background-color:#f4433614!important;border-color:#f44336b3!important}[_nghost-%COMP%]     .filter-toggles .mat-mdc-chip-option[color=warn].mdc-evolution-chip--selected{background-color:#f44336!important;border-color:#f44336!important;color:#fff!important}[_nghost-%COMP%]     .filter-toggles .mat-mdc-chip-option[color=warn].mdc-evolution-chip--selected:hover{background-color:#d32f2f!important;border-color:#d32f2f!important}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:20px;color:#666}.table-card[_ngcontent-%COMP%]{overflow:hidden}table[_ngcontent-%COMP%]{width:100%}.mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.product-image[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:4px;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:#f5f5f5}.product-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.product-name[_ngcontent-%COMP%]{display:flex;flex-direction:column}.product-sku[_ngcontent-%COMP%]{color:#666;font-size:12px}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;color:#666}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}@media (max-width: 960px){.produtos-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:16px}.header-actions[_ngcontent-%COMP%]{justify-content:flex-end}.filters-container[_ngcontent-%COMP%]{flex-direction:column}.search-field[_ngcontent-%COMP%]{width:100%}.filter-toggles[_ngcontent-%COMP%]{width:100%;justify-content:flex-start}}[_nghost-%COMP%]     .mat-mdc-card{border-radius:8px;box-shadow:0 2px 4px #0000001a}[_nghost-%COMP%]     .mat-mdc-card-header{padding:16px}[_nghost-%COMP%]     .mat-mdc-card-content{padding:0 16px 16px}.mat-mdc-row[_ngcontent-%COMP%]{transition:background-color .2s ease}.product-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transition:transform .2s ease}.product-image[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.1)}"]})};export{Nt as ProdutosComponent};
